<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- bootstrap library and JS, Jquery -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"></script><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>JDBC And JPA In SpringBoot | KaizenThink</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="JDBC And JPA In SpringBoot" />
<meta name="author" content="Duc Nguyen" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="In this post we will learn about JDBC and JPA in SpringBoot that we usually use in our projects for interaction with relational Database." />
<meta property="og:description" content="In this post we will learn about JDBC and JPA in SpringBoot that we usually use in our projects for interaction with relational Database." />
<link rel="canonical" href="/java/2021/09/11/java-springboot-JDBC-JPA.html" />
<meta property="og:url" content="/java/2021/09/11/java-springboot-JDBC-JPA.html" />
<meta property="og:site_name" content="KaizenThink" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-09-11T00:00:00+07:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="JDBC And JPA In SpringBoot" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"/java/2021/09/11/java-springboot-JDBC-JPA.html"},"@type":"BlogPosting","url":"/java/2021/09/11/java-springboot-JDBC-JPA.html","author":{"@type":"Person","name":"Duc Nguyen"},"headline":"JDBC And JPA In SpringBoot","dateModified":"2021-09-11T00:00:00+07:00","datePublished":"2021-09-11T00:00:00+07:00","description":"In this post we will learn about JDBC and JPA in SpringBoot that we usually use in our projects for interaction with relational Database.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="KaizenThink" /><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NZ8G5007GK"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NZ8G5007GK');
</script></head><body>
  <div class="container-flush">
    <div class="row"><!-- navigation bar -->
<div class="col-lg-12">
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark" role="banner"><a class="navbar-brand site-title" rel="author" href="/">KaizenThink</a>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="nav navbar-nav"><li class="nav-item active">
          <a class="nav-link" href="/about">About</a>
        </li><li class="nav-item active">
          <a class="nav-link" href="/">Java</a>
        </li><li class="nav-item active">
          <a class="nav-link" href="/docker">Docker</a>
        </li><li class="nav-item active">
          <a class="nav-link" href="/database">Database</a>
        </li><li class="nav-item active">
          <a class="nav-link" href="/data-science">Data-Science</a>
        </li><li class="nav-item active">
          <a class="nav-link" href="/ci-cd">CI-CD</a>
        </li><li class="nav-item active">
          <a class="nav-link" href="/python">Python</a>
        </li><li class="nav-item active">
          <a class="nav-link" href="/fe">FE</a>
        </li><li class="nav-item active">
          <a class="nav-link" href="/others">Others</a>
        </li></ul>
    </div>

    <!-- Html Elements for Search -->
    <div id="search-container" class="btn-group">
      <input type="text" id="search-input" placeholder="search...">
      <button id="clear">clear</button>
      <ul id="results-container"></ul>
    </div>

    <!-- Script pointing to search-script.js -->
    <script src="/java-scripts/search-script.js" type="text/javascript"></script>

    <!-- Configuration -->
    <script>
      SimpleJekyllSearch({
        searchInput: document.getElementById('search-input'),
        resultsContainer: document.getElementById('results-container'),
        json: '/search.json'
      })
    </script>

    <!-- search clear -->
    <script>
      window.addEventListener('load', () => {
        const button = document.querySelector('#clear');
        button.addEventListener('click', () => {
          document.querySelector('#search-input').value = "";
          document.querySelector('#results-container').innerHTML = "";
        });
      });
    </script>
    <!-- enable checkboxes-->
    <script>
      window.addEventListener('DOMContentLoaded', () => {
        const checkboxes = document.getElementsByClassName('task-list-item-checkbox');
        for(ind=0;ind<checkboxes.length;ind++) {
          checkboxes[ind].removeAttribute('disabled');
        }
      });
    </script>
  </nav>
</div></div>
  </div>

  <div class="container">
    <div class="row">
      <div class="col-lg-8 mx-auto">
  <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
      <h1 class="post-title p-name" itemprop="name headline">JDBC And JPA In SpringBoot</h1>
      <p class="post-meta">
        <time class="dt-published" datetime="2021-09-11T00:00:00+07:00" itemprop="datePublished">Sep 11, 2021
        </time></p>
    </header>
  
    <div class="post-content e-content" itemprop="articleBody">
      <blockquote>
  <p>In this post we will learn about JDBC and JPA in SpringBoot that we usually use in our projects for interaction with relational Database.</p>
</blockquote>

<ul id="markdown-toc">
  <li><a href="#what-is-the-jpa" id="markdown-toc-what-is-the-jpa">WHAT IS THE JPA?</a></li>
  <li><a href="#what-is-the-object-relational-mapping-orm" id="markdown-toc-what-is-the-object-relational-mapping-orm">WHAT IS THE OBJECT-RELATIONAL MAPPING (ORM)?</a></li>
  <li><a href="#what-is-the-hibernate" id="markdown-toc-what-is-the-hibernate">WHAT IS THE HIBERNATE?</a></li>
  <li><a href="#what-is-the-jdbc" id="markdown-toc-what-is-the-jdbc">WHAT IS THE JDBC?</a></li>
  <li><a href="#some-differencies-between-jdbc-and-hibernate" id="markdown-toc-some-differencies-between-jdbc-and-hibernate">SOME DIFFERENCIES BETWEEN JDBC AND HIBERNATE</a></li>
  <li><a href="#jdbc-and-jpa-in-springboot" id="markdown-toc-jdbc-and-jpa-in-springboot">JDBC AND JPA IN SPRINGBOOT</a></li>
  <li><a href="#what-is-the-hikaricp" id="markdown-toc-what-is-the-hikaricp">WHAT IS THE HIKARICP?</a></li>
  <li><a href="#example-with-jdbc-core" id="markdown-toc-example-with-jdbc-core">EXAMPLE WITH JDBC CORE</a>    <ul>
      <li><a href="#dependencies" id="markdown-toc-dependencies">DEPENDENCIES</a></li>
      <li><a href="#dao" id="markdown-toc-dao">DAO</a></li>
      <li><a href="#service" id="markdown-toc-service">SERVICE</a></li>
      <li><a href="#configuration" id="markdown-toc-configuration">CONFIGURATION</a></li>
      <li><a href="#testing" id="markdown-toc-testing">TESTING</a></li>
    </ul>
  </li>
  <li><a href="#example-with-jpa" id="markdown-toc-example-with-jpa">EXAMPLE WITH JPA</a>    <ul>
      <li><a href="#dependencies-1" id="markdown-toc-dependencies-1">DEPENDENCIES</a></li>
      <li><a href="#entity" id="markdown-toc-entity">ENTITY</a></li>
      <li><a href="#repository" id="markdown-toc-repository">REPOSITORY</a></li>
      <li><a href="#service-1" id="markdown-toc-service-1">SERVICE</a></li>
      <li><a href="#configuration-1" id="markdown-toc-configuration-1">CONFIGURATION</a></li>
      <li><a href="#testing-1" id="markdown-toc-testing-1">TESTING</a></li>
    </ul>
  </li>
  <li><a href="#summary" id="markdown-toc-summary">SUMMARY</a></li>
  <li><a href="#references" id="markdown-toc-references">REFERENCES</a></li>
</ul>

<h2 id="what-is-the-jpa">WHAT IS THE JPA?</h2>

<ul>
  <li>
    <p>The <code class="language-plaintext highlighter-rouge">Java Persistence API (JPA)</code> represents a simplification of the persistence programming model.</p>
  </li>
  <li>
    <p>Data persistence, the ability to maintain data between application sessions in some form of nonvolatile storage (such as a relational database), is crucial to enterprise applications. Applications that are developed for this environment must either manage data persistence themselves or make use of third-party solutions to handle database updates and retrievals. JPA provides a mechanism for managing data persistence and object-relational mapping and functions.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">JPA</code> is based on the Java programming model that applies to Java EE environments, but JPA can also function within the Java SE environment. The JPA specification defines the <code class="language-plaintext highlighter-rouge">object-relational mapping (ORM)</code> internally, rather than relying on vendor-specific mapping implementations, and uses either annotations or XML to map objects into database tables.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">JPA</code> is designed to operate both inside and outside of a Java Enterprise Edition (Java EE) container. When you run JPA inside a container, applications can use the container to manage the persistence. If there is no container to manage JPA, the application must handle the persistence management itself. Applications that are designed for container managed persistence cannot be used outside a container, while applications that manage their own persistence can function either in a container environment or a Java SE environment.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">JPA</code> also provides a query language - JPQL - that you can use to retrieve objects without writing SQL queries specific to the database you are working with.</p>
  </li>
  <li>Java EE containers that support JPA must supply a persistence provider. A JPA persistence provider uses the following elements to persist data in an EJB 3.0 environment:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">Entity</code> objects: An entity is a simple Java class that represents a row in a database table. Entities can be concrete classes or abstract classes. They maintain states by using properties or fields.</li>
      <li><code class="language-plaintext highlighter-rouge">EntityManager</code>: An <code class="language-plaintext highlighter-rouge">EntityManager</code> object maintains the active collection of entity objects that are being used by the application. The <code class="language-plaintext highlighter-rouge">EntityManager</code> object handles the database interaction and metadata for object-relational mappings. An instance of an <code class="language-plaintext highlighter-rouge">EntityManager</code> object represents a persistence context. An application in a container can obtain the <code class="language-plaintext highlighter-rouge">EntityManager</code> either through injection into the application or by looking it up in the Java component namespace. If the application manages its persistence, the <code class="language-plaintext highlighter-rouge">EntityManager</code> is obtained from the <code class="language-plaintext highlighter-rouge">EntityManagerFactory</code>. The application server containers typically supply this function, but the <code class="language-plaintext highlighter-rouge">EntityManagerFactory</code> is required if you are using JPA application-managed persistence.</li>
      <li><code class="language-plaintext highlighter-rouge">EntityManagerFactory</code>: The factory is used to create an <code class="language-plaintext highlighter-rouge">EntityManager</code> for database interactions.</li>
      <li><code class="language-plaintext highlighter-rouge">Persistence unit</code>: A persistence unit consists of the declarative metadata that describes the relationship of entity class objects to a relational database. The EntityManagerFactory uses this data to create a persistence context that can be accessed through the EntityManager.</li>
      <li><code class="language-plaintext highlighter-rouge">Persistence context</code>: The persistence context is the set of active instances that the application is handling. The persistence context can be created manually or through injection.</li>
    </ul>
  </li>
  <li>
    <p><a href="https://www.ibm.com/docs/en/wasdtfe?topic=applications-jpa-architecture">You can find more here</a></p>
  </li>
  <li>
    <p>In JPA, the <code class="language-plaintext highlighter-rouge">EntityManager</code> interface is used to allow applications to manage and search for entities in the relational database.</p>
  </li>
  <li>
    <p>The <code class="language-plaintext highlighter-rouge">EntityManager</code> is an API that manages the lifecycle of entity instances. An <code class="language-plaintext highlighter-rouge">EntityManager</code> object manages a set of entities that are defined by a persistence unit. Each <code class="language-plaintext highlighter-rouge">EntityManager</code> instance is associated with a persistence context. A persistence context defines the scope under which particular entity instances are created, persisted, and removed through the APIs made available by <code class="language-plaintext highlighter-rouge">EntityManager</code>. In some ways, a persistence context is conceptually similar to a transaction context.</p>
  </li>
  <li>
    <p>The entity manager tracks all entity objects within a persistence context for changes and updates that are made, and flushes these changes to the database. Once a persistence context is closed, all managed entity object instances become detached from the persistence context and its associated entity manager, and are no longer managed. Once an object is detached from a persistence context, it can no longer be managed by an entity manager, and any state changes to this object instance will not be synchronized with the database.</p>
  </li>
  <li>
    <p><a href="https://www.ibm.com/docs/en/wasdtfe?topic=architecture-entity-manager">You can view more here</a></p>
  </li>
  <li>
    <p>The <code class="language-plaintext highlighter-rouge">Persistence Contex</code>t is responsible for JPA entity management: When an application loads an entity from the database, the entity is in fact stored in the Persistence Context, so the entity becomes managed by the Persistence Context. Any further change made over that same entity will be monitored by the Persistence Context.</p>
  </li>
  <li>
    <p>The <code class="language-plaintext highlighter-rouge">Persistence Context</code> will also flush changed entities to the database when appropriate. When a transaction commits, the associated Persistence Context will also flush any eventual pending changes to the Database. These are some of the operations that are handled by the Persistence Context.</p>
  </li>
  <li>
    <p>There are two distinct types of Persistence Context: <code class="language-plaintext highlighter-rouge">Container Managed</code> and <code class="language-plaintext highlighter-rouge">Application Managed</code>.</p>
  </li>
  <li>
    <p>The <code class="language-plaintext highlighter-rouge">Container Managed Persistence Context</code> - as the name states - is managed by the enterprise container (JEE Container or Spring). The container is responsible for Persistence Context injection into enterprise components, and is also responsible for its disposal at the end of the current transaction. <code class="language-plaintext highlighter-rouge">Container-managed persistence context</code>  might be defined to have one of two different scopes: <code class="language-plaintext highlighter-rouge">Transaction persistence scope</code> or <code class="language-plaintext highlighter-rouge">Extended persistence scope</code>.</p>
  </li>
  <li>
    <p>The <code class="language-plaintext highlighter-rouge">Application Managed Persistence Context</code> is managed by the application (JSE): The application is responsible for Persistence Context creation and disposal. The application is also required to ensure that the application created Persistence Context is aware of any eventual ongoing transaction. An <code class="language-plaintext highlighter-rouge">Application Managed Persistence Context scope</code> is always <code class="language-plaintext highlighter-rouge">Extended persistence scope</code>.</p>
  </li>
  <li>
    <p><a href="https://www.byteslounge.com/tutorials/container-vs-application-managed-entitymanager">You can find more here</a></p>
  </li>
  <li>
    <p>The container, before performing an operation on the Entity, checks if there is a <code class="language-plaintext highlighter-rouge">Persistence Context</code> connected to the transaction; if not present, it creates a new Persistence Context (session) and connects it. In practice, an EntityManager is automatically created for each new transaction. Operations such as commits and rollbacks are handled automatically by the Container.</p>
  </li>
  <li>
    <p>For the Application Managed Persistence Context, developers have to create each time the EntityManager from the EntityManagerFactory. They have more control over the flow, but also more responsibilities (e.g. they have to remember to close the EntityManager, they have to explicitly call commit and rollback operations).</p>
  </li>
  <li>
    <p><a href="https://www.vincenzoracca.com/en/blog/framework/jpa/jpa-em/">You can find more here</a></p>
  </li>
  <li>
    <p>Session per request is a transactional pattern to tie the persistence session and request life-cycles together. Not surprisingly, Spring comes with its own implementation of this pattern, named OpenSessionInViewInterceptor, to facilitate working with lazy associations and therefore, improving developer productivity.</p>
  </li>
  <li>
    <p>By default In Spring Boot Service, JPA use OSIV (Open session in view) parttern with <code class="language-plaintext highlighter-rouge">open-in-view=true</code> configuration which allow a session will be created when the a HTTP request come in the Spring Boot service and this seesion will be closed until the HTTP request has been end. This Session is bound into the TransactionSynchronizationManager. So It means that there is a transaction that will be opened from from the beginning to the end of the HTTP request. So that’s the reason why although you put a lot of queries and do update to many tables in Database or get child entities from parent entities you just can see in the log just one JDBC connection is used (physical database connection) with many SQL statements. So, if your service is small and you don’t call any request to another system, just work with your DB so it is okay for you, you can manipulate with data in DB anywhere in your service methods. But if you have to call to another system, so using this way is not too good, because the transaction and database connection will be hold for a long time and can make the connection pool become full if there are may request at the same time, you can see this issue happen when you run your spring boot service on production.</p>
  </li>
  <li>
    <p>If we set <code class="language-plaintext highlighter-rouge">open-in-view=false</code>, then be careful when you use Lazy loading because now, every executed query will be made in a transaction and connection privately, you can image that if there are 3 queries in your service method, so every time the query is executed, then a transaction and connection will be created and executed into the database and closed, then 3 queries you will have 3 times to make connections to DB. So if you use lazy load, you get parent from the first query, then you get childs from parent the LazyInitializationException will be through because the transaction of getting parent has been closed. So using this way is better when your service is interacting with many systems, the DB connections in pool will not be hold for a long time and we can improve our service performance on production when we received many connections because connections are opened and closed instantly.</p>
  </li>
  <li><a href="https://stackoverflow.com/questions/30549489/what-is-this-spring-jpa-open-in-view-true-property-in-spring-boot">You can find more here</a></li>
  <li><a href="https://www.baeldung.com/spring-open-session-in-view#choose-wisely">You can find more here</a></li>
</ul>

<h2 id="what-is-the-object-relational-mapping-orm">WHAT IS THE OBJECT-RELATIONAL MAPPING (ORM)?</h2>

<ul>
  <li>
    <p>Object-Relational Mapping (ORM) is a programming technique for converting data between relational databases and object oriented programming languages such as Java, C#, etc.</p>
  </li>
  <li>
    <p>An ORM system has the following advantages over plain JDBC</p>
  </li>
</ul>

<table>
  <thead>
    <tr>
      <th>No.</th>
      <th>Advantages</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>Let’s business code access objects rather than DB tables.</td>
    </tr>
    <tr>
      <td>2</td>
      <td>Hides details of SQL queries from OO logic.</td>
    </tr>
    <tr>
      <td>3</td>
      <td>Based on JDBC</td>
    </tr>
    <tr>
      <td>4</td>
      <td>No need to deal with the database implementation.</td>
    </tr>
    <tr>
      <td>5</td>
      <td>Entities based on business concepts rather than database structure.</td>
    </tr>
    <tr>
      <td>6</td>
      <td>Transaction management and automatic key generation.</td>
    </tr>
    <tr>
      <td>7</td>
      <td>Fast development of application.</td>
    </tr>
  </tbody>
</table>

<p>An ORM solution consists of the following four entities −</p>

<table>
  <thead>
    <tr>
      <th>No.</th>
      <th>Solutions</th>
      <th> </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>An API to perform basic CRUD operations on objects of persistent classes.</td>
      <td> </td>
    </tr>
    <tr>
      <td>2</td>
      <td>A language or API to specify queries that refer to classes and properties of</td>
      <td>classes.</td>
    </tr>
    <tr>
      <td>3</td>
      <td>A configurable facility for specifying mapping metadata.</td>
      <td> </td>
    </tr>
    <tr>
      <td>4</td>
      <td>A technique to interact with transactional objects to perform dirty checking, lazy association fetching, and other optimization functions.</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<ul>
  <li>There are several persistent frameworks and ORM options in Java. A persistent framework is an ORM service that stores and retrieves objects into a relational database.
    <ul>
      <li>TopLink</li>
      <li>Hibernate</li>
      <li>And many more</li>
    </ul>
  </li>
  <li>
    <p>In this post, we will mainly focus on <code class="language-plaintext highlighter-rouge">Hibernate</code>.</p>
  </li>
  <li><a href="https://www.tutorialspoint.com/hibernate/orm_overview.htm">From Source Information</a></li>
</ul>

<h2 id="what-is-the-hibernate">WHAT IS THE HIBERNATE?</h2>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Hibernate</code> is an open-source, non-invasive, light-weight java ORM(Object-relational mapping) framework to develop objects which are independent of the database software and make independent persistence logic in all JAVA, JEE. It simplifies the interaction of java applications with databases. Hibernate is an implementation of JPA(Java Persistence API).</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Hibernate</code> maps Java classes to database tables and from <strong>Java data types</strong> to <strong>SQL data types</strong> and relieves the developer from 95% of common data persistence related programming tasks.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Hibernate</code> sits between traditional Java objects and database server to handle all the works in persisting those objects based on the appropriate O/R mechanisms and patterns.</p>
  </li>
</ul>

<p><a href="/assets/images/database/orm-example.PNG"><img src="/assets/images/database/orm-example.PNG" alt="Hibernate Example" title="Hibernate Example" /></a></p>

<ul>
  <li>
    <p><a href="https://dzone.com/articles/what-is-the-difference-between-hibernate-and-sprin-1">More information</a></p>
  </li>
  <li>
    <p>There is an important thing to remember that “internally”, <code class="language-plaintext highlighter-rouge">Hibernate</code> uses <code class="language-plaintext highlighter-rouge">JDBC</code> to interact with the database.</p>
  </li>
</ul>

<h2 id="what-is-the-jdbc">WHAT IS THE JDBC?</h2>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">JDBC</code> stands for <code class="language-plaintext highlighter-rouge">Java Database Connectivity</code>. <strong>JDBC</strong> is a <strong>Java API</strong> to connect and execute the query with the database. It is a part of JavaSE (Java Standard Edition). <strong>JDBC API</strong> uses <strong>JDBC drivers</strong> to connect with the database.</p>
  </li>
  <li>
    <p>We can use <strong>JDBC API</strong> to access tabular data stored in any relational database. By the help of <strong>JDBC API</strong>, we can save, update, delete and fetch data from the database.</p>
  </li>
  <li>The JDBC interface consists of two layers:
    <ul>
      <li>The JDBC API supports communication between the Java application and the JDBC manager.</li>
      <li>The JDBC driver supports communication between the JDBC manager and the database driver.</li>
    </ul>
  </li>
  <li>
    <p>JDBC is the common API that your application code interacts with. Beneath that is the JDBC-compliant driver for the database you are using.</p>
  </li>
  <li><a href="https://www.infoworld.com/article/3388036/what-is-jdbc-introduction-to-java-database-connectivity.html">More information</a></li>
</ul>

<p><a href="/assets/images/database/jdbc-structure.jpg"><img src="/assets/images/database/jdbc-structure.jpg" alt="JDBC in the Java persistence layer" title="JDBC in the Java persistence layer" /></a></p>

<h2 id="some-differencies-between-jdbc-and-hibernate">SOME DIFFERENCIES BETWEEN JDBC AND HIBERNATE</h2>

<ul>
  <li>Because Hibernate is used as an implementation of JPA, so we will compare some differencies between JDBC and Hibernate as below.</li>
</ul>

<table>
  <thead>
    <tr>
      <th>NO</th>
      <th>JDBC</th>
      <th>HIBERNATE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1.</td>
      <td>In <code class="language-plaintext highlighter-rouge">JDBC</code>, one needs to <strong>write code to map</strong> the object model’s data representation to the schema of the relational model.</td>
      <td><code class="language-plaintext highlighter-rouge">Hibernate</code> maps the object model’s data to the schema of the database itself <strong>with the help of annotations</strong>.</td>
    </tr>
    <tr>
      <td>2.</td>
      <td><code class="language-plaintext highlighter-rouge">JDBC</code> enables developers to create queries and update data to a relational database <code class="language-plaintext highlighter-rouge">using the Structured Query Language (SQL)</code>.</td>
      <td><code class="language-plaintext highlighter-rouge">Hibernate</code> <code class="language-plaintext highlighter-rouge">uses HQL (Hibernate Query Language)</code> which is similar to SQL but understands object-oriented concepts like inheritance, association etc.</td>
    </tr>
    <tr>
      <td>3.</td>
      <td><code class="language-plaintext highlighter-rouge">JDBC</code> code needs to be written in a try catch block as it throws checked exception(SQLexception).</td>
      <td>Whereas <code class="language-plaintext highlighter-rouge">Hibernate</code> manages the exceptions itself by marking them as unchecked.</td>
    </tr>
    <tr>
      <td>4.</td>
      <td><code class="language-plaintext highlighter-rouge">JDBC</code> is database dependent i.e. one needs to write different codes for different database.</td>
      <td>Whereas <code class="language-plaintext highlighter-rouge">Hibernate</code> is database independent and same code can work for many databases with minor changes.</td>
    </tr>
    <tr>
      <td>5.</td>
      <td>Creating associations between relations is quite <strong>hard</strong> in <code class="language-plaintext highlighter-rouge">JDBC</code>.</td>
      <td>Associations like one-to-one, one-to-many, many-to-one, and many-to-many can be acquired <strong>easily</strong> with the help of annotations.</td>
    </tr>
  </tbody>
</table>

<ul>
  <li><a href="https://www.geeksforgeeks.org/difference-between-jdbc-and-hibernate-in-java/">View more</a></li>
</ul>

<h2 id="jdbc-and-jpa-in-springboot">JDBC AND JPA IN SPRINGBOOT</h2>

<ul>
  <li>
    <p>In <code class="language-plaintext highlighter-rouge">SpringBoot projects</code>, we usually use dependency libraries <code class="language-plaintext highlighter-rouge">spring-boot-starter-jdbc</code> for JDBC and <code class="language-plaintext highlighter-rouge">spring-boot-starter-data-jpa</code> for JPA. We should note that these SpringBoot dependencies will wrap many others libraries, <code class="language-plaintext highlighter-rouge">JPA core</code> and <code class="language-plaintext highlighter-rouge">JDBC core</code> are just a part of them.</p>
  </li>
  <li>For this reason, If you use the <code class="language-plaintext highlighter-rouge">spring-jdbc</code> on SpringFramework project, you will not see the dependency <code class="language-plaintext highlighter-rouge">HikariCP</code> and you have to import this dependency manually. For <code class="language-plaintext highlighter-rouge">SpringBoot projects</code> you just need to import only one dependency <code class="language-plaintext highlighter-rouge">spring-boot-starter-jdbc</code> then you will also have <code class="language-plaintext highlighter-rouge">HikariCP</code>. Likewise, in dependency <code class="language-plaintext highlighter-rouge">spring-boot-starter-data-jpa</code> for SpringBoot projects, It will contains these 3 main dependencies:
    <ul>
      <li>
        <ol>
          <li><code class="language-plaintext highlighter-rouge">spring-boot-starter-jdbc</code>
            <ul>
              <li><code class="language-plaintext highlighter-rouge">HikariCP</code></li>
            </ul>
          </li>
        </ol>
      </li>
      <li>
        <ol>
          <li><code class="language-plaintext highlighter-rouge">spring-data-jpa</code></li>
        </ol>
      </li>
      <li>
        <ol>
          <li><code class="language-plaintext highlighter-rouge">hibernate-core</code></li>
        </ol>
      </li>
      <li>other dependencies.</li>
    </ul>
  </li>
  <li>See the dependencies tree of <code class="language-plaintext highlighter-rouge">spring-boot-starter-data-jpa</code> as below:</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
+- org.springframework.boot:spring-boot-starter-data-jpa:jar:2.4.4:compile
|  +- org.springframework.boot:spring-boot-starter-aop:jar:2.4.4:compile
|  |  +- org.springframework:spring-aop:jar:5.3.5:compile
|  |  \- org.aspectj:aspectjweaver:jar:1.9.6:compile
|  +- org.springframework.boot:spring-boot-starter-jdbc:jar:2.4.4:compile
|  |  +- com.zaxxer:HikariCP:jar:3.4.5:compile
|  |  \- org.springframework:spring-jdbc:jar:5.3.5:compile
|  +- jakarta.transaction:jakarta.transaction-api:jar:1.3.3:compile
|  +- jakarta.persistence:jakarta.persistence-api:jar:2.2.3:compile
|  +- org.hibernate:hibernate-core:jar:5.4.29.Final:compile
|  |  +- org.jboss.logging:jboss-logging:jar:3.4.1.Final:compile
|  |  +- org.javassist:javassist:jar:3.27.0-GA:compile
|  |  +- net.bytebuddy:byte-buddy:jar:1.10.21:compile
|  |  +- antlr:antlr:jar:2.7.7:compile
|  |  +- org.jboss:jandex:jar:2.2.3.Final:compile
|  |  +- com.fasterxml:classmate:jar:1.5.1:compile
|  |  +- org.dom4j:dom4j:jar:2.1.3:compile
|  |  +- org.hibernate.common:hibernate-commons-annotations:jar:5.1.2.Final:compile
|  |  \- org.glassfish.jaxb:jaxb-runtime:jar:2.3.1:compile
|  |     +- org.glassfish.jaxb:txw2:jar:2.3.1:compile
|  |     +- com.sun.istack:istack-commons-runtime:jar:3.0.7:compile
|  |     +- org.jvnet.staxex:stax-ex:jar:1.8:compile
|  |     \- com.sun.xml.fastinfoset:FastInfoset:jar:1.2.15:compile
|  +- org.springframework.data:spring-data-jpa:jar:2.4.6:compile
|  |  +- org.springframework.data:spring-data-commons:jar:2.4.6:compile
|  |  +- org.springframework:spring-orm:jar:5.3.5:compile
|  |  +- org.springframework:spring-context:jar:5.3.5:compile
|  |  +- org.springframework:spring-tx:jar:5.3.5:compile
|  |  +- org.springframework:spring-beans:jar:5.3.5:compile
|  |  +- org.springframework:spring-core:jar:5.3.5:compile
|  |  |  \- org.springframework:spring-jcl:jar:5.3.5:compile
|  |  \- org.slf4j:slf4j-api:jar:1.7.26:compile
|  \- org.springframework:spring-aspects:jar:5.3.5:compile

</code></pre></div></div>

<h2 id="what-is-the-hikaricp">WHAT IS THE HIKARICP?</h2>

<ul>
  <li>So as you can see I mentioned about <code class="language-plaintext highlighter-rouge">HikariCP</code> above very much, so what is it? and why is it important for our projects?</li>
  <li>HikariCP is solid high-performance JDBC connection pool. A connection pool is a cache of database connections maintained so that the connections can be reused when future requests to the database are required. Connection pools may significantly reduce the overall resource usage. <a href="https://zetcode.com/articles/hikaricp/">You can find more here</a>.</li>
  <li>HikariCP is a very lightweight and high performance compared with other connection pooling frameworks. So It is the reason why <code class="language-plaintext highlighter-rouge">HikariCP</code> become the default pool implemntation in Spring Boot 2.0.</li>
  <li>One more thing, HikariCP has some default configurations and configure HikariCP is also simple, so It will not take you many times to work with.<a href="https://github.com/brettwooldridge/HikariCP">You can find more here</a>.</li>
</ul>

<h2 id="example-with-jdbc-core">EXAMPLE WITH JDBC CORE</h2>

<ul>
  <li>In this post, we will make examples with JDBC core and JPA to see differents and how strong JPA supports us in Spring Boot projects.</li>
</ul>

<h3 id="dependencies">DEPENDENCIES</h3>

<ul>
  <li>So in this example we need to imports dependencies as <code class="language-plaintext highlighter-rouge">spring-jdbc</code> and <code class="language-plaintext highlighter-rouge">commons-dbcp</code> as below. In which <code class="language-plaintext highlighter-rouge">commons-dbcp</code> (dbcp - Database Connection Pool) from Apache will help us to manage database connections pool.</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
  <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>spring-jdbc<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>5.3.14<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>commons-dbcp<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>commons-dbcp<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>1.4<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>8.0.27<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>

</code></pre></div></div>

<h3 id="dao">DAO</h3>

<ul>
  <li>In Database we will have some tables with <strong>One to Many</strong> relationships as the image below</li>
</ul>

<p><a href="/assets/images/spring-boot-jdbc-core-database-tables.png"><img src="/assets/images/spring-boot-jdbc-core-database-tables.png" alt="Tables Relationships" title="Tables Relationships" /></a></p>

<ul>
  <li>
    <p>Note: you need to go to Database and create these tables manually before running this Spring Boot application.</p>
  </li>
  <li>
    <p>Then we will crate a DAO (Data Access Object) java class which will contain queries for Create a customer with orders and items in database. The code in <code class="language-plaintext highlighter-rouge">CustomerDao</code> will look like as below</p>
  </li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">package</span> <span class="nn">com.springboot.data.jdbc.app.dao</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springboot.data.jdbc.app.model.OrderStatus</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springboot.data.jdbc.app.model.request.CustomerRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springboot.data.jdbc.app.model.request.ItemRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springboot.data.jdbc.app.model.request.OrderRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.JdbcTemplate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.namedparam.MapSqlParameterSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.namedparam.NamedParameterJdbcOperations</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.namedparam.SqlParameterSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.time.LocalDateTime</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.UUID</span><span class="o">;</span>

<span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomerDao</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">JdbcTemplate</span> <span class="n">jdbcTemplate</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">NamedParameterJdbcOperations</span> <span class="n">namedParameterJdbcOperations</span><span class="o">;</span>


    <span class="kd">public</span> <span class="no">UUID</span> <span class="nf">createCustomer</span><span class="o">(</span><span class="nc">CustomerRequest</span> <span class="n">customerRequest</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">sqlCustomerQuery</span> <span class="o">=</span>
                           <span class="s">"INSERT INTO customers(                          "</span>
                <span class="o">+</span>          <span class="s">"id,                                             "</span>   <span class="cm">/*1*/</span>
                <span class="o">+</span>          <span class="s">"address,                                        "</span>   <span class="cm">/*2*/</span>
                <span class="o">+</span>          <span class="s">"dob,                                            "</span>   <span class="cm">/*3*/</span>
                <span class="o">+</span>          <span class="s">"email,                                          "</span>   <span class="cm">/*4*/</span>
                <span class="o">+</span>          <span class="s">"full_name,                                      "</span>   <span class="cm">/*5*/</span>
                <span class="o">+</span>          <span class="s">"gender,                                         "</span>   <span class="cm">/*6*/</span>
                <span class="o">+</span>          <span class="s">"phone)                                          "</span>   <span class="cm">/*7*/</span>
                <span class="o">+</span>          <span class="s">"VALUES (?, ?, ?, ?, ?, ?, ?)                    "</span>
                <span class="o">;</span>
        <span class="no">UUID</span> <span class="n">uuid</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getRandomUUID</span><span class="o">();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">jdbcTemplate</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">sqlCustomerQuery</span><span class="o">,</span>
                <span class="n">uuid</span><span class="o">.</span><span class="na">toString</span><span class="o">(),</span>
                <span class="n">customerRequest</span><span class="o">.</span><span class="na">getAddress</span><span class="o">(),</span>
                <span class="n">customerRequest</span><span class="o">.</span><span class="na">getDob</span><span class="o">(),</span>
                <span class="n">customerRequest</span><span class="o">.</span><span class="na">getEmail</span><span class="o">(),</span>
                <span class="n">customerRequest</span><span class="o">.</span><span class="na">getFullName</span><span class="o">(),</span>
                <span class="n">customerRequest</span><span class="o">.</span><span class="na">getGender</span><span class="o">().</span><span class="na">toString</span><span class="o">(),</span>
                <span class="n">customerRequest</span><span class="o">.</span><span class="na">getPhone</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">uuid</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="no">UUID</span><span class="o">,</span> <span class="nc">OrderRequest</span><span class="o">&gt;</span> <span class="nf">createOrders</span><span class="o">(</span><span class="no">UUID</span> <span class="n">customerId</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">OrderRequest</span><span class="o">&gt;</span> <span class="n">orderRequestList</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="no">UUID</span><span class="o">,</span> <span class="nc">OrderRequest</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="kd">final</span> <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">orderRequestList</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
        <span class="nc">String</span> <span class="n">sqlOrderQuery</span> <span class="o">=</span>
                         <span class="s">"INSERT INTO orders(                                "</span>
                 <span class="o">+</span>       <span class="s">"id,                                                "</span> <span class="cm">/*1*/</span>
                 <span class="o">+</span>       <span class="s">"created_date,                                      "</span> <span class="cm">/*2*/</span>
                 <span class="o">+</span>       <span class="s">"last_updated_date,                                 "</span> <span class="cm">/*3*/</span>
                 <span class="o">+</span>       <span class="s">"order_name,                                        "</span> <span class="cm">/*4*/</span>
                 <span class="o">+</span>       <span class="s">"order_status,                                      "</span> <span class="cm">/*5*/</span>
                 <span class="o">+</span>       <span class="s">"customer_id)                                       "</span> <span class="cm">/*6*/</span>
                 <span class="o">+</span>       <span class="s">"VALUES(                                            "</span>
                 <span class="o">+</span>       <span class="s">":id,                                               "</span> <span class="cm">/*1*/</span>
                 <span class="o">+</span>       <span class="s">":created_date,                                     "</span> <span class="cm">/*2*/</span>
                 <span class="o">+</span>       <span class="s">":last_updated_date,                                "</span> <span class="cm">/*3*/</span>
                 <span class="o">+</span>       <span class="s">":order_name,                                       "</span> <span class="cm">/*4*/</span>
                 <span class="o">+</span>       <span class="s">":order_status,                                     "</span> <span class="cm">/*5*/</span>
                 <span class="o">+</span>       <span class="s">":customer_id)                                      "</span> <span class="cm">/*6*/</span>
                <span class="o">;</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">SqlParameterSource</span><span class="o">&gt;</span> <span class="n">sqlParameterSources</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">size</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">OrderRequest</span> <span class="nl">orderRequest:</span> <span class="n">orderRequestList</span><span class="o">)</span> <span class="o">{</span>
            <span class="no">UUID</span> <span class="n">uuid</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getRandomUUID</span><span class="o">();</span>
            <span class="nc">MapSqlParameterSource</span> <span class="n">mapSqlParameterSource</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MapSqlParameterSource</span><span class="o">();</span>
            <span class="nc">LocalDateTime</span> <span class="n">now</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
            <span class="n">mapSqlParameterSource</span><span class="o">.</span><span class="na">addValue</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="n">uuid</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
            <span class="n">mapSqlParameterSource</span><span class="o">.</span><span class="na">addValue</span><span class="o">(</span><span class="s">"created_date"</span><span class="o">,</span><span class="n">now</span><span class="o">);</span>
            <span class="n">mapSqlParameterSource</span><span class="o">.</span><span class="na">addValue</span><span class="o">(</span><span class="s">"last_updated_date"</span><span class="o">,</span> <span class="n">now</span><span class="o">);</span>
            <span class="n">mapSqlParameterSource</span><span class="o">.</span><span class="na">addValue</span><span class="o">(</span><span class="s">"order_name"</span><span class="o">,</span> <span class="n">orderRequest</span><span class="o">.</span><span class="na">getOrderName</span><span class="o">());</span>
            <span class="n">mapSqlParameterSource</span><span class="o">.</span><span class="na">addValue</span><span class="o">(</span><span class="s">"order_status"</span><span class="o">,</span> <span class="nc">OrderStatus</span><span class="o">.</span><span class="na">CREATED</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
            <span class="n">mapSqlParameterSource</span><span class="o">.</span><span class="na">addValue</span><span class="o">(</span><span class="s">"customer_id"</span><span class="o">,</span> <span class="n">customerId</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
            <span class="n">sqlParameterSources</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">mapSqlParameterSource</span><span class="o">);</span>
            <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">uuid</span><span class="o">,</span> <span class="n">orderRequest</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">this</span><span class="o">.</span><span class="na">namedParameterJdbcOperations</span><span class="o">.</span><span class="na">batchUpdate</span><span class="o">(</span><span class="n">sqlOrderQuery</span><span class="o">,</span> <span class="n">sqlParameterSources</span><span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="k">new</span> <span class="nc">SqlParameterSource</span><span class="o">[</span><span class="n">size</span><span class="o">]));</span>
        <span class="k">return</span> <span class="n">map</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">createItems</span><span class="o">(</span><span class="no">UUID</span> <span class="n">orderId</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">ItemRequest</span><span class="o">&gt;</span> <span class="n">itemRequests</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">itemRequests</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
        <span class="nc">String</span> <span class="n">itemSqlQuery</span> <span class="o">=</span>
                                <span class="s">"INSERT INTO items(                                 "</span>
                        <span class="o">+</span>       <span class="s">"id,                                                "</span> <span class="cm">/*1*/</span>
                        <span class="o">+</span>       <span class="s">"item_name,                                         "</span> <span class="cm">/*2*/</span>
                        <span class="o">+</span>       <span class="s">"price,                                             "</span> <span class="cm">/*3*/</span>
                        <span class="o">+</span>       <span class="s">"quantity,                                          "</span> <span class="cm">/*4*/</span>
                        <span class="o">+</span>       <span class="s">"order_id)                                          "</span> <span class="cm">/*5*/</span>
                        <span class="o">+</span>       <span class="s">"VALUES(                                            "</span>
                        <span class="o">+</span>       <span class="s">":id,                                               "</span> <span class="cm">/*1*/</span>
                        <span class="o">+</span>       <span class="s">":item_name,                                        "</span> <span class="cm">/*2*/</span>
                        <span class="o">+</span>       <span class="s">":price,                                            "</span> <span class="cm">/*3*/</span>
                        <span class="o">+</span>       <span class="s">":quantity,                                         "</span> <span class="cm">/*4*/</span>
                        <span class="o">+</span>       <span class="s">":order_id)                                         "</span> <span class="cm">/*5*/</span>
                        <span class="o">;</span>
        <span class="no">UUID</span> <span class="n">uuid</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getRandomUUID</span><span class="o">();</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">SqlParameterSource</span><span class="o">&gt;</span> <span class="n">sqlParameterSources</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">size</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">ItemRequest</span> <span class="nl">itemRequest:</span> <span class="n">itemRequests</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">MapSqlParameterSource</span> <span class="n">mapSqlParameterSource</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MapSqlParameterSource</span><span class="o">();</span>
            <span class="n">mapSqlParameterSource</span><span class="o">.</span><span class="na">addValue</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="n">uuid</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
            <span class="n">mapSqlParameterSource</span><span class="o">.</span><span class="na">addValue</span><span class="o">(</span><span class="s">"item_name"</span><span class="o">,</span> <span class="n">itemRequest</span><span class="o">.</span><span class="na">getItemName</span><span class="o">());</span>
            <span class="n">mapSqlParameterSource</span><span class="o">.</span><span class="na">addValue</span><span class="o">(</span><span class="s">"price"</span><span class="o">,</span> <span class="n">itemRequest</span><span class="o">.</span><span class="na">getPrice</span><span class="o">());</span>
            <span class="n">mapSqlParameterSource</span><span class="o">.</span><span class="na">addValue</span><span class="o">(</span><span class="s">"quantity"</span><span class="o">,</span> <span class="n">itemRequest</span><span class="o">.</span><span class="na">getQuantity</span><span class="o">());</span>
            <span class="n">mapSqlParameterSource</span><span class="o">.</span><span class="na">addValue</span><span class="o">(</span><span class="s">"order_id"</span><span class="o">,</span> <span class="n">orderId</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
            <span class="n">sqlParameterSources</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">mapSqlParameterSource</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">this</span><span class="o">.</span><span class="na">namedParameterJdbcOperations</span><span class="o">.</span><span class="na">batchUpdate</span><span class="o">(</span><span class="n">itemSqlQuery</span><span class="o">,</span> <span class="n">sqlParameterSources</span><span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="k">new</span> <span class="nc">SqlParameterSource</span><span class="o">[</span><span class="n">size</span><span class="o">]));</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="no">UUID</span> <span class="nf">getRandomUUID</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="no">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>Next we need to create a service named <code class="language-plaintext highlighter-rouge">CustomerJdbcService</code> to handle logics for create a Customer with many orders and items. The Customer will be created first, then if the Customer contains orders so orders will be created and if in every order which contains items then items will be also created. See example code below</li>
</ul>

<h3 id="service">SERVICE</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">package</span> <span class="nn">com.springboot.data.jdbc.app.service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springboot.data.jdbc.app.dao.CustomerDao</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springboot.data.jdbc.app.model.request.CustomerRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springboot.data.jdbc.app.model.request.OrderRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.UUID</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomerJdbcService</span> <span class="o">{</span>


    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">CustomerDao</span> <span class="n">customerDao</span><span class="o">;</span>

    <span class="kd">public</span> <span class="no">UUID</span> <span class="nf">createCustomer</span><span class="o">(</span><span class="nc">CustomerRequest</span> <span class="n">customerRequest</span><span class="o">)</span> <span class="o">{</span>
        <span class="no">UUID</span> <span class="n">customerId</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">customerDao</span><span class="o">.</span><span class="na">createCustomer</span><span class="o">(</span><span class="n">customerRequest</span><span class="o">);</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">OrderRequest</span><span class="o">&gt;</span> <span class="n">orders</span> <span class="o">=</span> <span class="n">customerRequest</span><span class="o">.</span><span class="na">getOrders</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">orders</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">orders</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="nc">Map</span><span class="o">&lt;</span><span class="no">UUID</span><span class="o">,</span> <span class="nc">OrderRequest</span><span class="o">&gt;</span> <span class="n">orderRequestMap</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">customerDao</span><span class="o">.</span><span class="na">createOrders</span><span class="o">(</span><span class="n">customerId</span><span class="o">,</span> <span class="n">customerRequest</span><span class="o">.</span><span class="na">getOrders</span><span class="o">());</span>
            <span class="k">for</span> <span class="o">(</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="no">UUID</span><span class="o">,</span> <span class="nc">OrderRequest</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">:</span> <span class="n">orderRequestMap</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">getValue</span><span class="o">().</span><span class="na">getItems</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">map</span><span class="o">.</span><span class="na">getValue</span><span class="o">().</span><span class="na">getItems</span><span class="o">().</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
                    <span class="k">this</span><span class="o">.</span><span class="na">customerDao</span><span class="o">.</span><span class="na">createItems</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">getKey</span><span class="o">(),</span> <span class="n">map</span><span class="o">.</span><span class="na">getValue</span><span class="o">().</span><span class="na">getItems</span><span class="o">());</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">customerId</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div>

<h3 id="configuration">CONFIGURATION</h3>

<ul>
  <li>Now we will go to connection pool configuration with <code class="language-plaintext highlighter-rouge">commons-dbcp</code> from Apache. To do this, firstly you need to add these enviroment variables below into <strong>application.yml</strong>.</li>
</ul>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="na">spring</span><span class="pi">:</span>
  <span class="na">datasource</span><span class="pi">:</span>
    <span class="na">driverClassName</span><span class="pi">:</span> <span class="s">com.mysql.cj.jdbc.Driver</span>
    <span class="na">url</span><span class="pi">:</span> <span class="s">jdbc:mysql://localhost:3306/sample?useUnicode=true&amp;characterEncoding=UTF-8</span>
    <span class="na">username</span><span class="pi">:</span> <span class="s">root</span>
    <span class="na">password</span><span class="pi">:</span> <span class="s">password</span>
    <span class="c1"># config dbcp pool for jdbc</span>
    <span class="na">maxWait</span><span class="pi">:</span> <span class="m">10000</span>
    <span class="na">maxActive</span><span class="pi">:</span> <span class="s">-1</span>
    <span class="na">maxIdle</span><span class="pi">:</span> <span class="m">20</span>
    <span class="na">minIdle</span><span class="pi">:</span> <span class="m">10</span>
    <span class="na">initialSize</span><span class="pi">:</span> <span class="m">10</span>

</code></pre></div></div>

<ul>
  <li>Then we will create an <code class="language-plaintext highlighter-rouge">ApplicationConfig</code> java class for <strong>DataSource</strong> and <strong>JdbcTemplate</strong> configurations as below</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">package</span> <span class="nn">com.springboot.data.jdbc.app.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.commons.dbcp.BasicDataSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.core.env.Environment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.JdbcTemplate</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.sql.DataSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Objects</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ApplicationConfig</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">Environment</span> <span class="n">env</span><span class="o">;</span>

    <span class="nd">@Bean</span><span class="o">(</span><span class="s">"dataSource"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">DataSource</span> <span class="nf">getDataSource</span><span class="o">()</span> <span class="o">{</span>

        <span class="kd">final</span> <span class="nc">String</span> <span class="n">sqlInitQuery</span> <span class="o">=</span> <span class="s">"SHOW PROCESSLIST;"</span><span class="o">;</span>

        <span class="nc">BasicDataSource</span> <span class="n">basicDataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BasicDataSource</span><span class="o">();</span>
        <span class="n">basicDataSource</span><span class="o">.</span><span class="na">setDriverClassName</span><span class="o">(</span><span class="nc">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">env</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"spring.datasource.driverClassName"</span><span class="o">)));</span>
        <span class="n">basicDataSource</span><span class="o">.</span><span class="na">setUrl</span><span class="o">(</span><span class="n">env</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"spring.datasource.url"</span><span class="o">));</span>
        <span class="n">basicDataSource</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="n">env</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"spring.datasource.username"</span><span class="o">));</span>
        <span class="n">basicDataSource</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="n">env</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"spring.datasource.password"</span><span class="o">));</span>
        <span class="n">basicDataSource</span><span class="o">.</span><span class="na">setInitialSize</span><span class="o">(</span><span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="nc">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">env</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"spring.datasource.initialSize"</span><span class="o">))));</span>
        <span class="n">basicDataSource</span><span class="o">.</span><span class="na">setMinIdle</span><span class="o">(</span><span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="nc">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">env</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"spring.datasource.minIdle"</span><span class="o">))));</span>
        <span class="n">basicDataSource</span><span class="o">.</span><span class="na">setMaxIdle</span><span class="o">(</span><span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="nc">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">env</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"spring.datasource.maxIdle"</span><span class="o">))));</span>
        <span class="n">basicDataSource</span><span class="o">.</span><span class="na">setMaxWait</span><span class="o">(</span><span class="nc">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="nc">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">env</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"spring.datasource.maxWait"</span><span class="o">))));</span>
        <span class="n">basicDataSource</span><span class="o">.</span><span class="na">setMaxActive</span><span class="o">(</span><span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="nc">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">env</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"spring.datasource.maxActive"</span><span class="o">))));</span>
        <span class="k">return</span> <span class="n">basicDataSource</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span><span class="o">(</span><span class="s">"jdbcTemplate"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">JdbcTemplate</span> <span class="nf">getJdbcTemplate</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">JdbcTemplate</span> <span class="n">jdbcTemplate</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JdbcTemplate</span><span class="o">();</span>
        <span class="n">jdbcTemplate</span><span class="o">.</span><span class="na">setDataSource</span><span class="o">(</span><span class="n">getDataSource</span><span class="o">());</span>
        <span class="n">jdbcTemplate</span><span class="o">.</span><span class="na">setLazyInit</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">jdbcTemplate</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>For <strong>DataSource</strong> configuration, we will create a <strong>BasicDataSource</strong> with some parameters that we will load from the <strong>application.yml</strong>.</li>
  <li>To configure <strong>BasicDataSource</strong> to make conntections to DB we just need to focus on those parameters in table below.</li>
</ul>

<table>
  <thead>
    <tr>
      <th>Prameter</th>
      <th>Description</th>
      <th>Set Method</th>
      <th>Sample Configuration Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>username</td>
      <td>The connection user name to be passed to our JDBC driver to establish a connection.</td>
      <td>setUsername()</td>
      <td>root</td>
    </tr>
    <tr>
      <td>password</td>
      <td>The connection password to be passed to our JDBC driver to establish a connection.</td>
      <td>setPassword()</td>
      <td>password</td>
    </tr>
    <tr>
      <td>url</td>
      <td>The connection URL to be passed to our JDBC driver to establish a connection.</td>
      <td>setUrl()</td>
      <td>jdbc:mysql://localhost:3306/sample?useUnicode=true&amp;characterEncoding=UTF-8</td>
    </tr>
    <tr>
      <td>driverClassName</td>
      <td>The fully qualified Java class name of the JDBC driver to be used.</td>
      <td>setDriverClassName()</td>
      <td>com.mysql.cj.jdbc.Driver</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>To configure <strong>BasicDataSource</strong> with DBCP (Database Connection Pool) we will focus on some parameters below</li>
</ul>

<table>
  <thead>
    <tr>
      <th>Prameter</th>
      <th>Description</th>
      <th>Set Method</th>
      <th>Default Value</th>
      <th>Sample Configuration Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>initialSize</td>
      <td>The initial number of connections that are created when the pool is started. Since: 1.2</td>
      <td>setInitialSize()</td>
      <td>0</td>
      <td>10</td>
    </tr>
    <tr>
      <td>maxTotal</td>
      <td>The maximum number of active connections that can be allocated from this pool at the same time, or negative for no limit.</td>
      <td>setMaxActive()</td>
      <td>8</td>
      <td>-1</td>
    </tr>
    <tr>
      <td>maxIdle</td>
      <td>The maximum number of connections that can remain idle in the pool, without extra ones being released, or negative for no limit.</td>
      <td>setMaxIdle()</td>
      <td>8</td>
      <td>20</td>
    </tr>
    <tr>
      <td>minIdle</td>
      <td>The minimum number of connections that can remain idle in the pool, without extra ones being created, or zero to create none.</td>
      <td>setMinIdle()</td>
      <td>0</td>
      <td>10</td>
    </tr>
    <tr>
      <td>maxWaitMillis</td>
      <td>The maximum number of milliseconds that the pool will wait (when there are no available connections) for a connection to be returned before throwing an exception, or -1 to wait indefinitely.</td>
      <td>setMaxWait()</td>
      <td>indefinitely</td>
      <td>10000</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>
    <p><a href="https://commons.apache.org/proper/commons-dbcp/configuration.html">You can find more here</a>.</p>
  </li>
  <li>
    <p>So after we have configured <strong>BasicDataSource</strong> then we will use it to create <strong>JdbcTemplate</strong> bean. As you can see in the code we will set <code class="language-plaintext highlighter-rouge">setLazyInit(false)</code>, So this mean when our application is started, all connections in pool will conntect to database.</p>
  </li>
</ul>

<h3 id="testing">TESTING</h3>

<ul>
  <li>So now, let’s start your Spring Boot service then login into mysql and use command <code class="language-plaintext highlighter-rouge">show processlist;</code> you will see the result as below</li>
</ul>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
mysql&gt; show processlist;
+----+-----------------+------------------+--------+---------+------+------------------------+------------------+
| Id | User            | Host             | db     | Command | Time | State                  | Info             |
+----+-----------------+------------------+--------+---------+------+------------------------+------------------+
|  5 | event_scheduler | localhost        | NULL   | Daemon  | 6356 | Waiting on empty queue | NULL             |
| 12 | root            | 172.18.0.1:43650 | sample | Sleep   |  156 |                        | NULL             |
| 13 | root            | 172.18.0.1:43652 | sample | Sleep   |  156 |                        | NULL             |
| 14 | root            | 172.18.0.1:43656 | sample | Sleep   |  156 |                        | NULL             |
| 15 | root            | 172.18.0.1:43658 | sample | Sleep   |  156 |                        | NULL             |
| 16 | root            | 172.18.0.1:43660 | sample | Sleep   |  156 |                        | NULL             |
| 17 | root            | 172.18.0.1:43662 | sample | Sleep   |  156 |                        | NULL             |
| 18 | root            | 172.18.0.1:43664 | sample | Sleep   |  156 |                        | NULL             |
| 19 | root            | 172.18.0.1:43666 | sample | Sleep   |  156 |                        | NULL             |
| 20 | root            | 172.18.0.1:43668 | sample | Sleep   |  156 |                        | NULL             |
| 21 | root            | 172.18.0.1:43670 | sample | Sleep   |  155 |                        | NULL             |
| 24 | root            | localhost        | NULL   | Query   |    0 | init                   | show processlist |
+----+-----------------+------------------+--------+---------+------+------------------------+------------------+
12 rows in set (0.00 sec)

</code></pre></div></div>

<ul>
  <li>As you can see, 10 database connections have been created (from Id 12 to Id 21) by our Spring Boot service to MySQL Database, It mean our database connection pool configuration has worked.</li>
  <li>Now when we execute a query from our Spring Boot service a transaction will be created then a database connection will be taken from the pool to run the query, when the query is commited a transaction will close and the connection will be available in pool again. So using connection pool will help us get connections to Database quickly and save time for create new connections for every executed query.</li>
</ul>

<h2 id="example-with-jpa">EXAMPLE WITH JPA</h2>

<ul>
  <li>As you can see in the JDBC example, we have to configure and write code very much in service and DAO layer. So JPA will support us better to handle these things.</li>
</ul>

<h3 id="dependencies-1">DEPENDENCIES</h3>

<ul>
  <li>So to use JPA you just simple import some dependencies as below</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-data-jpa<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>2.4.4<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>8.0.27<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

</code></pre></div></div>

<h3 id="entity">ENTITY</h3>

<ul>
  <li>We will create entities which represent for 3 tables in the database.</li>
</ul>

<p><a href="/assets/images/spring-boot-jdbc-core-database-tables.png"><img src="/assets/images/spring-boot-jdbc-core-database-tables.png" alt="Tables Relationships" title="Tables Relationships" /></a></p>

<ul>
  <li>
    <p>Note: You don’t need to create these 3 tables in the database because JPA will create for you automatically when the Spring Boot application has started.</p>
  </li>
  <li>
    <p>So in Entity classes we will use a lot of mapping annotations from JPA, so you can review these annotations in the table below:</p>
  </li>
</ul>

<table>
  <thead>
    <tr>
      <th>Annotation</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>@Entity</td>
      <td>The @Entity annotation is used to specify that the currently annotated class represents an entity type. Unlike basic and embeddable types, entity types have an identity and their state is managed by the underlying Persistence Context.</td>
    </tr>
    <tr>
      <td>@Table</td>
      <td>The @Table annotation is used to specify the primary table of the currently annotated entity.</td>
    </tr>
    <tr>
      <td>@Id</td>
      <td>The @Id annotation specifies the entity identifier. An entity must always have an identifier attribute which is used when loading the entity in a given Persistence Context.</td>
    </tr>
    <tr>
      <td>@GeneratedValue</td>
      <td>The @GeneratedValue annotation specifies that the entity identifier value is automatically generated using an identity column, a database sequence, or a table generator. Hibernate supports the @GeneratedValue mapping even for UUID identifiers.</td>
    </tr>
    <tr>
      <td>@Type</td>
      <td>The @Type annotation is used to specify the Hibernate @Type used by the currently annotated basic attribute.</td>
    </tr>
    <tr>
      <td>@Column</td>
      <td>The @Column annotation is used to specify the mapping between a basic entity attribute and the database table column.</td>
    </tr>
    <tr>
      <td>@Enumerated</td>
      <td>The @Enumerated annotation is used to specify that an entity attribute represents an enumerated type. In which, ORDINAL: stored according to the enum value’s ordinal position within the enum class, as indicated by java.lang.Enum#ordinal STRING: stored according to the enum value’s name, as indicated by java.lang.Enum#name</td>
    </tr>
    <tr>
      <td>@OneToMany</td>
      <td>The @OneToMany annotation is used to specify a one-to-many database relationship.</td>
    </tr>
    <tr>
      <td>@ManyToOne</td>
      <td>The @ManyToOne annotation is used to specify a many-to-one database relationship.</td>
    </tr>
    <tr>
      <td>@JoinColumn</td>
      <td>The @JoinColumn annotation is used to specify the FOREIGN KEY column used when joining an entity association or an embeddable collection.</td>
    </tr>
    <tr>
      <td>@PrePersist</td>
      <td>The @PrePersist annotation is used to specify a callback method that fires before an entity is persisted.</td>
    </tr>
    <tr>
      <td>@PreUpdate</td>
      <td>The @PreUpdate annotation is used to specify a callback method that fires before an entity is updated.</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>
    <p><a href="https://docs.jboss.org/hibernate/orm/5.4/userguide/html_single/Hibernate_User_Guide.html#configurations-internal">You can find more here</a>.</p>
  </li>
  <li>
    <p>The fist Entity is <code class="language-plaintext highlighter-rouge">CustomerEntity</code>, this Entity will be the parent of <code class="language-plaintext highlighter-rouge">OrderEntity</code> and one <code class="language-plaintext highlighter-rouge">CustomerEntity</code> will have many <code class="language-plaintext highlighter-rouge">OrderEntity</code>. The <code class="language-plaintext highlighter-rouge">CustomerEntity</code> java class will look like the code below.</p>
  </li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">package</span> <span class="nn">com.springboot.data.jpa.app.entity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springboot.data.jpa.app.model.response.CustomerResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.annotations.Type</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.CascadeType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Column</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.EnumType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Enumerated</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.FetchType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.OneToMany</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.UUID</span><span class="o">;</span>

<span class="c1">//The @Entity annotation is used to specify that the currently annotated class represents an entity type. Unlike basic and embeddable types, entity types have an identity and their state is managed by the underlying Persistence Context.</span>
<span class="nd">@Entity</span>
<span class="c1">//The @Table annotation is used to specify the primary table of the currently annotated entity.</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"customers"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomerEntity</span> <span class="o">{</span>

    <span class="c1">//The @Id annotation specifies the entity identifier. An entity must always have an identifier attribute which is used when loading the entity in a given Persistence Context.</span>
    <span class="nd">@Id</span>
    <span class="c1">//The @GeneratedValue annotation specifies that the entity identifier value is automatically generated using an identity column, a database sequence, or a table generator. Hibernate supports the @GeneratedValue mapping even for UUID identifiers.</span>
    <span class="nd">@GeneratedValue</span>
    <span class="c1">//The @Type annotation is used to specify the Hibernate @Type used by the currently annotated basic attribute.</span>
    <span class="nd">@Type</span><span class="o">(</span><span class="n">type</span><span class="o">=</span><span class="s">"uuid-char"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="no">UUID</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">fullName</span><span class="o">;</span>
    <span class="c1">//The @Column annotation is used to specify the mapping between a basic entity attribute and the database table column.</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">unique</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">email</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">address</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">phone</span><span class="o">;</span>
    <span class="c1">//The @Enumerated annotation is used to specify that an entity attribute represents an enumerated type.</span>
    <span class="nd">@Enumerated</span><span class="o">(</span><span class="nc">EnumType</span><span class="o">.</span><span class="na">STRING</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Gender</span> <span class="n">gender</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Date</span> <span class="n">dob</span><span class="o">;</span>

    <span class="c1">//The @OneToMany annotation is used to specify a one-to-many database relationship.</span>
    <span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"customer"</span><span class="o">,</span> <span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">,</span> <span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">OrderEntity</span><span class="o">&gt;</span> <span class="n">orders</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

    <span class="kd">public</span> <span class="no">UUID</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="no">UUID</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getFullName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">fullName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFullName</span><span class="o">(</span><span class="nc">String</span> <span class="n">fullName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">fullName</span> <span class="o">=</span> <span class="n">fullName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getEmail</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">email</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEmail</span><span class="o">(</span><span class="nc">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getAddress</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">address</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAddress</span><span class="o">(</span><span class="nc">String</span> <span class="n">address</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">address</span> <span class="o">=</span> <span class="n">address</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getPhone</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">phone</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPhone</span><span class="o">(</span><span class="nc">String</span> <span class="n">phone</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">phone</span> <span class="o">=</span> <span class="n">phone</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Gender</span> <span class="nf">getGender</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">gender</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setGender</span><span class="o">(</span><span class="nc">Gender</span> <span class="n">gender</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">gender</span> <span class="o">=</span> <span class="n">gender</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Date</span> <span class="nf">getDob</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">dob</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDob</span><span class="o">(</span><span class="nc">Date</span> <span class="n">dob</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">dob</span> <span class="o">=</span> <span class="n">dob</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">OrderEntity</span><span class="o">&gt;</span> <span class="nf">getOrders</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">orders</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setOrders</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">OrderEntity</span><span class="o">&gt;</span> <span class="n">orders</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">orders</span> <span class="o">=</span> <span class="n">orders</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>


</code></pre></div></div>

<ul>
  <li>Next we will create <code class="language-plaintext highlighter-rouge">OrderEntity</code>, so this Entity will be the parent of <code class="language-plaintext highlighter-rouge">ItemEntity</code> and One <code class="language-plaintext highlighter-rouge">OrderEntity</code> will have many <code class="language-plaintext highlighter-rouge">ItemEntity</code>. The <code class="language-plaintext highlighter-rouge">OrderEntity</code> java class will be look like as below</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">package</span> <span class="nn">com.springboot.data.jpa.app.entity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springboot.data.jpa.app.model.response.OrderResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.annotations.Type</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.CascadeType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.EnumType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Enumerated</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.FetchType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.JoinColumn</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.ManyToOne</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.OneToMany</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.PrePersist</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.PreUpdate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.time.LocalDateTime</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.UUID</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"orders"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderEntity</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="nd">@Type</span><span class="o">(</span><span class="n">type</span><span class="o">=</span><span class="s">"uuid-char"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="no">UUID</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">orderName</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">createdDate</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">lastUpdatedDate</span><span class="o">;</span>

    <span class="nd">@Enumerated</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="nc">EnumType</span><span class="o">.</span><span class="na">STRING</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">OrderStatus</span> <span class="n">orderStatus</span><span class="o">;</span>

    <span class="c1">//The @ManyToOne annotation is used to specify a many-to-one database relationship.</span>
    <span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
    <span class="c1">//The @JoinColumn annotation is used to specify the FOREIGN KEY column used when joining an entity association or an embeddable collection.</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"customer_id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">CustomerEntity</span> <span class="n">customer</span><span class="o">;</span>

    <span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"order"</span><span class="o">,</span> <span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">,</span> <span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">ItemEntity</span><span class="o">&gt;</span> <span class="n">items</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>


    <span class="kd">public</span> <span class="no">UUID</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="no">UUID</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getOrderName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">orderName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setOrderName</span><span class="o">(</span><span class="nc">String</span> <span class="n">orderName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">orderName</span> <span class="o">=</span> <span class="n">orderName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">CustomerEntity</span> <span class="nf">getCustomer</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">customer</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCustomer</span><span class="o">(</span><span class="nc">CustomerEntity</span> <span class="n">customer</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">customer</span> <span class="o">=</span> <span class="n">customer</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">LocalDateTime</span> <span class="nf">getCreatedDate</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">createdDate</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@PrePersist</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">setCreatedDate</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">LocalDateTime</span> <span class="n">localDateTime</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">createdDate</span> <span class="o">=</span> <span class="n">localDateTime</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">lastUpdatedDate</span> <span class="o">=</span> <span class="n">localDateTime</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">LocalDateTime</span> <span class="nf">getLastUpdatedDate</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">lastUpdatedDate</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@PreUpdate</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">setLastUpdatedDate</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">lastUpdatedDate</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">OrderStatus</span> <span class="nf">getOrderStatus</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">orderStatus</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setOrderStatus</span><span class="o">(</span><span class="nc">OrderStatus</span> <span class="n">orderStatus</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">orderStatus</span> <span class="o">=</span> <span class="n">orderStatus</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">ItemEntity</span><span class="o">&gt;</span> <span class="nf">getItems</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">items</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setItems</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">ItemEntity</span><span class="o">&gt;</span> <span class="n">items</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">items</span> <span class="o">=</span> <span class="n">items</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>Next we will create <code class="language-plaintext highlighter-rouge">ItemEntity</code>. The <code class="language-plaintext highlighter-rouge">OrderEntity</code> java class will be look like as below</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">package</span> <span class="nn">com.springboot.data.jpa.app.entity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springboot.data.jpa.app.model.response.ItemResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.annotations.Type</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.FetchType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.JoinColumn</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.ManyToOne</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.UUID</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"items"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ItemEntity</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="nd">@Type</span><span class="o">(</span><span class="n">type</span><span class="o">=</span><span class="s">"uuid-char"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="no">UUID</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">itemName</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">quantity</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">Float</span> <span class="n">price</span><span class="o">;</span>

    <span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"order_id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">OrderEntity</span> <span class="n">order</span><span class="o">;</span>

    <span class="kd">public</span> <span class="no">UUID</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="no">UUID</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getItemName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">itemName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setItemName</span><span class="o">(</span><span class="nc">String</span> <span class="n">itemName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">itemName</span> <span class="o">=</span> <span class="n">itemName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Long</span> <span class="nf">getQuantity</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">quantity</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setQuantity</span><span class="o">(</span><span class="nc">Long</span> <span class="n">quantity</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">quantity</span> <span class="o">=</span> <span class="n">quantity</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Float</span> <span class="nf">getPrice</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">price</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPrice</span><span class="o">(</span><span class="nc">Float</span> <span class="n">price</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">price</span> <span class="o">=</span> <span class="n">price</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">OrderEntity</span> <span class="nf">getOrder</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">order</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setOrder</span><span class="o">(</span><span class="nc">OrderEntity</span> <span class="n">order</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">order</span> <span class="o">=</span> <span class="n">order</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>So that’s all for creating Entities and relationships.</li>
</ul>

<h3 id="repository">REPOSITORY</h3>

<ul>
  <li>Now we will create the <code class="language-plaintext highlighter-rouge">CustomerRepository</code> which will look like as below</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">package</span> <span class="nn">com.springboot.data.jpa.app.repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springboot.data.jpa.app.entity.CustomerEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.jpa.repository.JpaRepository</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.UUID</span><span class="o">;</span>

<span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">CustomerRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">CustomerEntity</span><span class="o">,</span> <span class="no">UUID</span><span class="o">&gt;</span> <span class="o">{</span>
<span class="o">}</span>

</code></pre></div></div>

<h3 id="service-1">SERVICE</h3>

<ul>
  <li>Finally, we will create <code class="language-plaintext highlighter-rouge">CustomerJpaService</code> which will help us to handle logics for creating customer, orders and items.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">package</span> <span class="nn">com.springboot.data.jpa.app.service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springboot.data.jpa.app.entity.CustomerEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springboot.data.jpa.app.entity.OrderEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springboot.data.jpa.app.entity.OrderStatus</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springboot.data.jpa.app.model.request.CustomerRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springboot.data.jpa.app.model.request.ItemRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springboot.data.jpa.app.model.request.OrderRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springboot.data.jpa.app.model.response.CustomerResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springboot.data.jpa.app.repository.CustomerRepository</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springboot.data.jpa.app.entity.ItemEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Optional</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.UUID</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.stream.Collectors</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomerJpaService</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">CustomerRepository</span> <span class="n">customerRepository</span><span class="o">;</span>

    <span class="kd">public</span> <span class="no">UUID</span> <span class="nf">createCustomer</span><span class="o">(</span><span class="nc">CustomerRequest</span> <span class="n">customerRequest</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">CustomerEntity</span> <span class="n">customerEntity</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">toCustomerEntity</span><span class="o">(</span><span class="k">new</span> <span class="nc">CustomerEntity</span><span class="o">(),</span> <span class="n">customerRequest</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">customerRequest</span><span class="o">.</span><span class="na">getOrders</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">customerRequest</span><span class="o">.</span><span class="na">getOrders</span><span class="o">().</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="nc">List</span><span class="o">&lt;</span><span class="nc">OrderRequest</span><span class="o">&gt;</span> <span class="n">orderRequests</span> <span class="o">=</span> <span class="n">customerRequest</span><span class="o">.</span><span class="na">getOrders</span><span class="o">();</span>
            <span class="nc">List</span><span class="o">&lt;</span><span class="nc">OrderEntity</span><span class="o">&gt;</span> <span class="n">orderEntities</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">toOrderEntities</span><span class="o">(</span><span class="n">orderRequests</span><span class="o">);</span>
            <span class="n">orderEntities</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">o</span> <span class="o">-&gt;</span> <span class="n">o</span><span class="o">.</span><span class="na">setCustomer</span><span class="o">(</span><span class="n">customerEntity</span><span class="o">));</span>
            <span class="n">customerEntity</span><span class="o">.</span><span class="na">setOrders</span><span class="o">(</span><span class="n">orderEntities</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">customerRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">customerEntity</span><span class="o">).</span><span class="na">getId</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">CustomerResponse</span> <span class="nf">getCustomer</span><span class="o">(</span><span class="no">UUID</span> <span class="n">customerId</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">CustomerEntity</span><span class="o">&gt;</span> <span class="n">customerEntity</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">customerRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">customerId</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">customerEntity</span><span class="o">.</span><span class="na">isPresent</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">customerEntity</span><span class="o">.</span><span class="na">get</span><span class="o">().</span><span class="na">toCustomerResponse</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"Customer Not Found!"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateCustomer</span><span class="o">(</span><span class="no">UUID</span> <span class="n">customerId</span><span class="o">,</span> <span class="nc">CustomerRequest</span> <span class="n">customerRequest</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">CustomerEntity</span><span class="o">&gt;</span> <span class="n">customerEntity</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">customerRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">customerId</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">customerEntity</span><span class="o">.</span><span class="na">isPresent</span><span class="o">())</span> <span class="o">{</span>
           <span class="nc">CustomerEntity</span> <span class="n">updatedCustomerEntity</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">toCustomerEntity</span><span class="o">(</span><span class="n">customerEntity</span><span class="o">.</span><span class="na">get</span><span class="o">(),</span> <span class="n">customerRequest</span><span class="o">);</span>
            <span class="k">this</span><span class="o">.</span><span class="na">customerRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">updatedCustomerEntity</span><span class="o">);</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"Customer Not Found!"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteCustomer</span><span class="o">(</span><span class="no">UUID</span> <span class="n">customerId</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">customerRepository</span><span class="o">.</span><span class="na">deleteById</span><span class="o">(</span><span class="n">customerId</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">OrderEntity</span><span class="o">&gt;</span> <span class="nf">toOrderEntities</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">OrderRequest</span><span class="o">&gt;</span> <span class="n">orderRequests</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">orderRequests</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">map</span><span class="o">(</span><span class="n">o</span> <span class="o">-&gt;</span> <span class="k">this</span><span class="o">.</span><span class="na">toOrderEntity</span><span class="o">(</span><span class="k">new</span> <span class="nc">OrderEntity</span><span class="o">(),</span> <span class="n">o</span><span class="o">)).</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">OrderEntity</span> <span class="nf">toOrderEntity</span><span class="o">(</span><span class="nc">OrderEntity</span> <span class="n">orderEntity</span><span class="o">,</span> <span class="nc">OrderRequest</span> <span class="n">orderRequest</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">orderEntity</span><span class="o">.</span><span class="na">setOrderName</span><span class="o">(</span><span class="n">orderRequest</span><span class="o">.</span><span class="na">getOrderName</span><span class="o">());</span>
        <span class="n">orderEntity</span><span class="o">.</span><span class="na">setOrderStatus</span><span class="o">(</span><span class="nc">OrderStatus</span><span class="o">.</span><span class="na">CREATED</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">orderRequest</span><span class="o">.</span><span class="na">getItems</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">orderRequest</span><span class="o">.</span><span class="na">getItems</span><span class="o">().</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="nc">List</span><span class="o">&lt;</span><span class="nc">ItemEntity</span><span class="o">&gt;</span> <span class="n">itemEntities</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">toItemEntities</span><span class="o">(</span><span class="n">orderRequest</span><span class="o">.</span><span class="na">getItems</span><span class="o">());</span>
            <span class="n">itemEntities</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="n">i</span><span class="o">.</span><span class="na">setOrder</span><span class="o">(</span><span class="n">orderEntity</span><span class="o">));</span>
            <span class="n">orderEntity</span><span class="o">.</span><span class="na">setItems</span><span class="o">(</span><span class="n">itemEntities</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">orderEntity</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">ItemEntity</span><span class="o">&gt;</span> <span class="nf">toItemEntities</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">ItemRequest</span><span class="o">&gt;</span> <span class="n">itemRequests</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">itemRequests</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">map</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="k">this</span><span class="o">.</span><span class="na">toItemEntity</span><span class="o">(</span><span class="k">new</span> <span class="nc">ItemEntity</span><span class="o">(),</span> <span class="n">i</span><span class="o">)).</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">ItemEntity</span> <span class="nf">toItemEntity</span><span class="o">(</span><span class="nc">ItemEntity</span> <span class="n">itemEntity</span><span class="o">,</span> <span class="nc">ItemRequest</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">itemEntity</span><span class="o">.</span><span class="na">setItemName</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">getItemName</span><span class="o">());</span>
        <span class="n">itemEntity</span><span class="o">.</span><span class="na">setQuantity</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">getQuantity</span><span class="o">());</span>
        <span class="n">itemEntity</span><span class="o">.</span><span class="na">setPrice</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">getPrice</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">itemEntity</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">CustomerEntity</span> <span class="nf">toCustomerEntity</span><span class="o">(</span><span class="nc">CustomerEntity</span> <span class="n">customerEntity</span><span class="o">,</span> <span class="nc">CustomerRequest</span> <span class="n">customerRequest</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">customerEntity</span><span class="o">.</span><span class="na">setAddress</span><span class="o">(</span><span class="n">customerRequest</span><span class="o">.</span><span class="na">getAddress</span><span class="o">());</span>
        <span class="n">customerEntity</span><span class="o">.</span><span class="na">setDob</span><span class="o">(</span><span class="n">customerRequest</span><span class="o">.</span><span class="na">getDob</span><span class="o">());</span>
        <span class="n">customerEntity</span><span class="o">.</span><span class="na">setEmail</span><span class="o">(</span><span class="n">customerRequest</span><span class="o">.</span><span class="na">getEmail</span><span class="o">());</span>
        <span class="n">customerEntity</span><span class="o">.</span><span class="na">setGender</span><span class="o">(</span><span class="n">customerRequest</span><span class="o">.</span><span class="na">getGender</span><span class="o">());</span>
        <span class="n">customerEntity</span><span class="o">.</span><span class="na">setFullName</span><span class="o">(</span><span class="n">customerRequest</span><span class="o">.</span><span class="na">getFullName</span><span class="o">());</span>
        <span class="n">customerEntity</span><span class="o">.</span><span class="na">setPhone</span><span class="o">(</span><span class="n">customerRequest</span><span class="o">.</span><span class="na">getPhone</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">customerEntity</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h3 id="configuration-1">CONFIGURATION</h3>

<ul>
  <li>Now, we will add some configurations into <code class="language-plaintext highlighter-rouge">application.yml</code> for Datasource and Connection Pool, because In <code class="language-plaintext highlighter-rouge">spring-boot-starter-data-jpa</code> dependency, we have <code class="language-plaintext highlighter-rouge">spring-boot-starter-jdbc</code> dependency and in JDBC dependency we have <code class="language-plaintext highlighter-rouge">HikariCP</code> dependency. So we can configure HiKariCP from the <code class="language-plaintext highlighter-rouge">application.yml</code> as below</li>
</ul>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="na">spring</span><span class="pi">:</span>
  <span class="na">datasource</span><span class="pi">:</span>
    <span class="na">driverClassName</span><span class="pi">:</span> <span class="s">com.mysql.cj.jdbc.Driver</span>
    <span class="na">url</span><span class="pi">:</span> <span class="s">jdbc:mysql://localhost:3306/sample?useUnicode=true&amp;characterEncoding=UTF-8</span>
    <span class="na">username</span><span class="pi">:</span> <span class="s">root</span>
    <span class="na">password</span><span class="pi">:</span> <span class="s">password</span>

    <span class="c1">#config hikari pool for jpa</span>
    <span class="na">hikari</span><span class="pi">:</span>
      <span class="na">connection-timeout</span><span class="pi">:</span> <span class="m">30000</span>
      <span class="na">maximum-pool-size</span><span class="pi">:</span> <span class="m">20</span>
      <span class="na">minimumIdle</span><span class="pi">:</span> <span class="m">15</span>
      <span class="na">idleTimeout</span><span class="pi">:</span> <span class="m">30000</span>
      <span class="na">maxLifetime</span><span class="pi">:</span> <span class="m">180000</span>
  <span class="na">jpa</span><span class="pi">:</span>
    <span class="na">database-platform</span><span class="pi">:</span> <span class="s">org.hibernate.dialect.MySQL5InnoDBDialect</span>
    <span class="na">hibernate.ddl-auto</span><span class="pi">:</span> <span class="s">update</span>
    <span class="na">generate-ddl</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">show-sql</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">open-in-view</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">properties</span><span class="pi">:</span>
      <span class="na">hibernate</span><span class="pi">:</span>
        <span class="na">generate_statistics</span><span class="pi">:</span> <span class="no">true</span>

<span class="na">logging</span><span class="pi">:</span>
  <span class="na">level</span><span class="pi">:</span>
    <span class="na">org</span><span class="pi">:</span>
      <span class="na">hibernate</span><span class="pi">:</span>
        <span class="na">stat</span><span class="pi">:</span> <span class="s">DEBUG</span>

</code></pre></div></div>

<ul>
  <li>For configure DataSource we will focus on properties as below</li>
</ul>

<table>
  <thead>
    <tr>
      <th>Configuretion Properties</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>spring.datasource.driver-class-name</td>
      <td>Fully qualified name of the JDBC driver. Auto-detected based on the URL by default.</td>
    </tr>
    <tr>
      <td>spring.datasource.url</td>
      <td>JDBC URL of the database.</td>
    </tr>
    <tr>
      <td>spring.datasource.username</td>
      <td>Login username of the database.</td>
    </tr>
    <tr>
      <td>spring.datasource.password</td>
      <td>Login password of the database.</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>So for congiure <code class="language-plaintext highlighter-rouge">HikariCP</code> we will focus on some properties as below</li>
</ul>

<table>
  <thead>
    <tr>
      <th>Configuretion Properties</th>
      <th>Description</th>
      <th>Default Value</th>
      <th>Sample Configuration Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>connection-timeout</td>
      <td>This property controls the maximum number of milliseconds that a client (that’s you) will wait for a connection from the pool. If this time is exceeded without a connection becoming available, a SQLException will be thrown. Lowest acceptable connection timeout is 250 ms.</td>
      <td>30000</td>
      <td>30000</td>
    </tr>
    <tr>
      <td>maximum-pool-size</td>
      <td>This property controls the maximum size that the pool is allowed to reach, including both idle and in-use connections. Basically this value will determine the maximum number of actual connections to the database backend. A reasonable value for this is best determined by your execution environment. When the pool reaches this size, and no idle connections are available, calls to getConnection() will block for up to connectionTimeout milliseconds before timing out</td>
      <td>10</td>
      <td>20</td>
    </tr>
    <tr>
      <td>minimumIdle</td>
      <td>This property controls the minimum number of idle connections that HikariCP tries to maintain in the pool. If the idle connections dip below this value and total connections in the pool are less than maximumPoolSize, HikariCP will make a best effort to add additional connections quickly and efficiently. However, for maximum performance and responsiveness to spike demands, we recommend not setting this value and instead allowing HikariCP to act as a fixed size connection pool.</td>
      <td>same as maximumPoolSize</td>
      <td>15</td>
    </tr>
    <tr>
      <td>idleTimeout</td>
      <td>This property controls the maximum amount of time that a connection is allowed to sit idle in the pool. This setting only applies when minimumIdle is defined to be less than maximumPoolSize. Idle connections will not be retired once the pool reaches minimumIdle connections. Whether a connection is retired as idle or not is subject to a maximum variation of +30 seconds, and average variation of +15 seconds. A connection will never be retired as idle before this timeout. A value of 0 means that idle connections are never removed from the pool. The minimum allowed value is 10000ms (10 seconds)</td>
      <td>600000 (10 minutes)</td>
      <td>30000</td>
    </tr>
    <tr>
      <td>maxLifetime</td>
      <td>This property controls the maximum lifetime of a connection in the pool. An in-use connection will never be retired, only when it is closed will it then be removed. On a connection-by-connection basis, minor negative attenuation is applied to avoid mass-extinction in the pool. We strongly recommend setting this value, and it should be several seconds shorter than any database or infrastructure imposed connection time limit. A value of 0 indicates no maximum lifetime (infinite lifetime), subject of course to the idleTimeout setting. The minimum allowed value is 30000ms (30 seconds)</td>
      <td>1800000 (30 minutes)</td>
      <td>180000</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>
    <p><a href="https://github.com/brettwooldridge/HikariCP">You can find more here</a>.</p>
  </li>
  <li>
    <p>For JPA configuration properties, you can view the table below for more details.</p>
  </li>
</ul>

<table>
  <thead>
    <tr>
      <th>Configuration Properties</th>
      <th>Description</th>
      <th>Default Value</th>
      <th>Sample Configuration Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>spring.jpa.database-platform</td>
      <td>Name of the target database to operate on, auto-detected by default. Can be alternatively set using the “Database” enum.</td>
      <td> </td>
      <td>org.hibernate.dialect.MySQL5InnoDBDialect</td>
    </tr>
    <tr>
      <td>spring.jpa.generate-ddl</td>
      <td>Whether to initialize the schema on startup.</td>
      <td>false</td>
      <td>true</td>
    </tr>
    <tr>
      <td>spring.jpa.hibernate.ddl-auto</td>
      <td>DDL mode. This is actually a shortcut for the “hibernate.hbm2ddl.auto” property. Defaults to “create-drop” when using an embedded database and no schema manager was detected. Otherwise, defaults to “none”.</td>
      <td>“none”</td>
      <td>update</td>
    </tr>
    <tr>
      <td>spring.jpa.show-sql</td>
      <td>Whether to enable logging of SQL statements</td>
      <td>false</td>
      <td>true</td>
    </tr>
    <tr>
      <td>spring.jpa.open-in-view</td>
      <td>Register OpenEntityManagerInViewInterceptor. Binds a JPA EntityManager to the thread for the entire processing of the request.</td>
      <td>true</td>
      <td>true</td>
    </tr>
    <tr>
      <td>spring.jpa.properties.*</td>
      <td>Additional native properties to set on the JPA provider.</td>
      <td> </td>
      <td> </td>
    </tr>
  </tbody>
</table>

<h3 id="testing-1">TESTING</h3>

<ul>
  <li>Now, let’s start your Spring Boot service then login into mysql and use command <code class="language-plaintext highlighter-rouge">show processlist;</code> you will see the result as below</li>
</ul>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
mysql&gt; show processlist;
+----+-----------------+------------------+--------+---------+------+------------------------+------------------+
| Id | User            | Host             | db     | Command | Time | State                  | Info             |
+----+-----------------+------------------+--------+---------+------+------------------------+------------------+
|  5 | event_scheduler | localhost        | NULL   | Daemon  |  531 | Waiting on empty queue | NULL             |
| 28 | root            | localhost        | NULL   | Query   |    0 | init                   | show processlist |
| 29 | root            | 172.18.0.1:49390 | sample | Sleep   |    5 |                        | NULL             |
| 30 | root            | 172.18.0.1:49392 | sample | Sleep   |    5 |                        | NULL             |
| 31 | root            | 172.18.0.1:49394 | sample | Sleep   |    5 |                        | NULL             |
| 32 | root            | 172.18.0.1:49396 | sample | Sleep   |    5 |                        | NULL             |
| 33 | root            | 172.18.0.1:49398 | sample | Sleep   |    5 |                        | NULL             |
| 34 | root            | 172.18.0.1:49400 | sample | Sleep   |    4 |                        | NULL             |
| 35 | root            | 172.18.0.1:49404 | sample | Sleep   |    4 |                        | NULL             |
| 36 | root            | 172.18.0.1:49406 | sample | Sleep   |    4 |                        | NULL             |
| 37 | root            | 172.18.0.1:49408 | sample | Sleep   |    3 |                        | NULL             |
| 38 | root            | 172.18.0.1:49410 | sample | Sleep   |    3 |                        | NULL             |
| 39 | root            | 172.18.0.1:49414 | sample | Sleep   |    3 |                        | NULL             |
| 40 | root            | 172.18.0.1:49416 | sample | Sleep   |    3 |                        | NULL             |
| 41 | root            | 172.18.0.1:49418 | sample | Sleep   |    2 |                        | NULL             |
| 42 | root            | 172.18.0.1:49420 | sample | Sleep   |    2 |                        | NULL             |
| 43 | root            | 172.18.0.1:49424 | sample | Sleep   |    1 |                        | NULL             |
+----+-----------------+------------------+--------+---------+------+------------------------+------------------+
17 rows in set (0.00 sec)

</code></pre></div></div>

<ul>
  <li>As you can see, the <code class="language-plaintext highlighter-rouge">HikariCP</code> configuration has worked, it created 15 connections in the pool of Spring Boot service to database (from Id 29 to Id 43).</li>
  <li>Then, if you use command <code class="language-plaintext highlighter-rouge">show tables from &lt;database name&gt;;</code> (show table in your database), then you can see JPA has created all tables based on entities for you.</li>
</ul>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
mysql&gt; show tables from sample;
+------------------+
| Tables_in_sample |
+------------------+
| customers        |
| items            |
| orders           |
+------------------+
3 rows in set (0.01 sec)

</code></pre></div></div>

<ul>
  <li>Moreover, if you use command <code class="language-plaintext highlighter-rouge">select * from INFORMATION_SCHEMA.TABLE_CONSTRAINTS c where c.constraint_schema = 'sample';</code> to check your tables relationships, then you also see JPA craeted all for you.</li>
</ul>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
mysql&gt; select * from INFORMATION_SCHEMA.TABLE_CONSTRAINTS c where c.constraint_schema = 'sample';
+--------------------+-------------------+------------------------------+--------------+------------+-----------------+----------+
| CONSTRAINT_CATALOG | CONSTRAINT_SCHEMA | CONSTRAINT_NAME              | TABLE_SCHEMA | TABLE_NAME | CONSTRAINT_TYPE | ENFORCED |
+--------------------+-------------------+------------------------------+--------------+------------+-----------------+----------+
| def                | sample            | PRIMARY                      | sample       | customers  | PRIMARY KEY     | YES      |
| def                | sample            | UK_rfbvkrffamfql7cjmen8v976v | sample       | customers  | UNIQUE          | YES      |
| def                | sample            | PRIMARY                      | sample       | items      | PRIMARY KEY     | YES      |
| def                | sample            | FKirjef006njdi706iiqdfkgk9d  | sample       | items      | FOREIGN KEY     | YES      |
| def                | sample            | PRIMARY                      | sample       | orders     | PRIMARY KEY     | YES      |
| def                | sample            | FKpxtb8awmi0dk6smoh2vp1litg  | sample       | orders     | FOREIGN KEY     | YES      |
+--------------------+-------------------+------------------------------+--------------+------------+-----------------+----------+

</code></pre></div></div>

<p><a href="/assets/images/spring-boot-jdbc-core-database-tables.png"><img src="/assets/images/spring-boot-jdbc-core-database-tables.png" alt="Tables Relationships" title="Tables Relationships" /></a></p>

<ul>
  <li>Next, Try to add a new customer and call update customer api with orders and items as the requests below and then you will recieve a successful status.</li>
</ul>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">
</span><span class="err">//create</span><span class="w"> </span><span class="err">new</span><span class="w"> </span><span class="err">customer</span><span class="w">
</span><span class="err">curl</span><span class="w"> </span><span class="err">--location</span><span class="w"> </span><span class="err">--request</span><span class="w"> </span><span class="err">POST</span><span class="w"> </span><span class="err">'http://localhost:</span><span class="mi">8080</span><span class="err">/v</span><span class="mi">1</span><span class="err">/jpa/customers'</span><span class="w"> </span><span class="err">\</span><span class="w">
</span><span class="err">--header</span><span class="w"> </span><span class="err">'Content-Type:</span><span class="w"> </span><span class="err">application/json'</span><span class="w"> </span><span class="err">\</span><span class="w">
</span><span class="err">--data-raw</span><span class="w"> </span><span class="err">'</span><span class="p">{</span><span class="w">
    </span><span class="nl">"fullName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Nguyen Minh Duc"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"abc1@gmail.com"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Binh Duong Province"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0123456789"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"gender"</span><span class="p">:</span><span class="w"> </span><span class="s2">"M"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"dob"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1995-10-10"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"orders"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"orderName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PC"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"items"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"itemName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Monitor"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"quantity"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"price"</span><span class="p">:</span><span class="w"> </span><span class="mf">100.0</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">   
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="err">'</span><span class="w">

</span><span class="err">//update</span><span class="w"> </span><span class="err">customer</span><span class="w">
</span><span class="err">curl</span><span class="w"> </span><span class="err">--location</span><span class="w"> </span><span class="err">--request</span><span class="w"> </span><span class="err">PUT</span><span class="w"> </span><span class="err">'http://localhost:</span><span class="mi">8080</span><span class="err">/v</span><span class="mi">1</span><span class="err">/jpa/customers/</span><span class="mi">9</span><span class="err">c</span><span class="mi">107</span><span class="err">c</span><span class="mi">20</span><span class="err">-d</span><span class="mi">989-4628-83e1</span><span class="err">-e</span><span class="mi">728</span><span class="err">b</span><span class="mi">3</span><span class="err">d</span><span class="mi">4</span><span class="err">a</span><span class="mi">5e5</span><span class="err">'</span><span class="w"> </span><span class="err">\</span><span class="w">
</span><span class="err">--header</span><span class="w"> </span><span class="err">'Content-Type:</span><span class="w"> </span><span class="err">application/json'</span><span class="w"> </span><span class="err">\</span><span class="w">
</span><span class="err">--data-raw</span><span class="w"> </span><span class="err">'</span><span class="p">{</span><span class="w">
    </span><span class="nl">"fullName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Nguyen Minh Duc"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"abc4@gmail.com"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Binh Duong Province"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0123456789"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"gender"</span><span class="p">:</span><span class="w"> </span><span class="s2">"M"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"dob"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1995-10-10"</span><span class="w">
</span><span class="p">}</span><span class="err">'</span><span class="w">

</span></code></pre></div></div>

<p><a href="/assets/images/spring-boot-jpa-test-customer.png"><img src="/assets/images/spring-boot-jpa-test-customer.png" alt="Create a customer" title="Create a customer" /></a></p>

<p><a href="/assets/images/spring-boot-jpa-test-update-customer.png"><img src="/assets/images/spring-boot-jpa-test-update-customer.png" alt="update a customer" title="update a customer" /></a></p>

<ul>
  <li>If you check the Spring Boot application log, you will see for creating new customer, there are 3 SQL statements have been executed and inserted into <code class="language-plaintext highlighter-rouge">customers</code>, <code class="language-plaintext highlighter-rouge">orders</code> and <code class="language-plaintext highlighter-rouge">items</code> tables. For updating customer, it will take 2 SQL statements. Then you can see creating or updating customer took only 1 JDBC connection. It is because by default, JPA is using <code class="language-plaintext highlighter-rouge">open-in-view=true</code>, so a transaction will be opened from from the beginning to the end of the HTTP request, if you do many sql statements in a request, so there is only one transaction and the transaction will be committed into database when the request is going to close, so that’s why it takes only 1 JDBC connection from the connection pool.</li>
</ul>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Hibernate: insert into customers (address, dob, email, full_name, gender, phone, id) values (?, ?, ?, ?, ?, ?, ?)
Hibernate: insert into orders (created_date, customer_id, last_updated_date, order_name, order_status, id) values (?, ?, ?, ?, ?, ?)
Hibernate: insert into items (item_name, order_id, price, quantity, id) values (?, ?, ?, ?, ?)
2022-01-29 10:14:24.377  INFO 31073 --- [nio-8080-exec-2] i.StatisticalLoggingSessionEventListener : Session Metrics {
    1096712 nanoseconds spent acquiring 1 JDBC connections;
    0 nanoseconds spent releasing 0 JDBC connections;
    4879830 nanoseconds spent preparing 3 JDBC statements;
    6299283 nanoseconds spent executing 3 JDBC statements;
    0 nanoseconds spent executing 0 JDBC batches;
    0 nanoseconds spent performing 0 L2C puts;
    0 nanoseconds spent performing 0 L2C hits;
    0 nanoseconds spent performing 0 L2C misses;
    40854489 nanoseconds spent executing 1 flushes (flushing a total of 3 entities and 2 collections);
    0 nanoseconds spent executing 0 partial-flushes (flushing a total of 0 entities and 0 collections)
}
Hibernate: select customeren0_.id as id1_0_0_, customeren0_.address as address2_0_0_, customeren0_.dob as dob3_0_0_, customeren0_.email as email4_0_0_, customeren0_.full_name as full_nam5_0_0_, customeren0_.gender as gender6_0_0_, customeren0_.phone as phone7_0_0_ from customers customeren0_ where customeren0_.id=?
Hibernate: update customers set address=?, dob=?, email=?, full_name=?, gender=?, phone=? where id=?
2022-01-29 10:14:39.224  INFO 31073 --- [nio-8080-exec-3] i.StatisticalLoggingSessionEventListener : Session Metrics {
    616086 nanoseconds spent acquiring 1 JDBC connections;
    0 nanoseconds spent releasing 0 JDBC connections;
    344811 nanoseconds spent preparing 2 JDBC statements;
    1715262 nanoseconds spent executing 2 JDBC statements;
    0 nanoseconds spent executing 0 JDBC batches;
    0 nanoseconds spent performing 0 L2C puts;
    0 nanoseconds spent performing 0 L2C hits;
    0 nanoseconds spent performing 0 L2C misses;
    3348529 nanoseconds spent executing 1 flushes (flushing a total of 1 entities and 1 collections);
    0 nanoseconds spent executing 0 partial-flushes (flushing a total of 0 entities and 0 collections)
}

</code></pre></div></div>

<ul>
  <li>Then, check your tables in database, you will there all information have been inserted correctly</li>
</ul>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
mysql&gt; select * from customers;
+--------------------------------------+---------------------+---------------------+----------------+-----------------+--------+------------+
| id                                   | address             | dob                 | email          | full_name       | gender | phone      |
+--------------------------------------+---------------------+---------------------+----------------+-----------------+--------+------------+
| 9c107c20-d989-4628-83e1-e728b3d4a5e5 | Binh Duong Province | 1995-10-10 07:00:00 | abc4@gmail.com | Nguyen Minh Duc | M      | 0123456789 |
+--------------------------------------+---------------------+---------------------+----------------+-----------------+--------+------------+
1 row in set (0.00 sec)

mysql&gt; select * from orders;
+--------------------------------------+---------------------+---------------------+------------+--------------+--------------------------------------+
| id                                   | created_date        | last_updated_date   | order_name | order_status | customer_id                          |
+--------------------------------------+---------------------+---------------------+------------+--------------+--------------------------------------+
| ea8cc0ce-6232-4ff3-ac91-e8146b6e57ad | 2022-01-29 10:14:24 | 2022-01-29 10:14:24 | PC         | CREATED      | 9c107c20-d989-4628-83e1-e728b3d4a5e5 |
+--------------------------------------+---------------------+---------------------+------------+--------------+--------------------------------------+
1 row in set (0.00 sec)

mysql&gt; select * from items;
+--------------------------------------+-----------+-------+----------+--------------------------------------+
| id                                   | item_name | price | quantity | order_id                             |
+--------------------------------------+-----------+-------+----------+--------------------------------------+
| 5bd4fb0b-a1b0-4e21-becb-5bd2df4982bd | Monitor   |   100 |        1 | ea8cc0ce-6232-4ff3-ac91-e8146b6e57ad |
+--------------------------------------+-----------+-------+----------+--------------------------------------+
1 row in set (0.00 sec)

</code></pre></div></div>

<ul>
  <li>As you can see, JPA helps you to reduce the workload, you can insert data without writing any SQL native queries.</li>
  <li>Next, we will set <code class="language-plaintext highlighter-rouge">open-in-view=false</code> then call the <code class="language-plaintext highlighter-rouge">update customer api</code> to see what will happen when we update the customer as above.</li>
</ul>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">
</span><span class="err">curl</span><span class="w"> </span><span class="err">--location</span><span class="w"> </span><span class="err">--request</span><span class="w"> </span><span class="err">PUT</span><span class="w"> </span><span class="err">'http://localhost:</span><span class="mi">8080</span><span class="err">/v</span><span class="mi">1</span><span class="err">/jpa/customers/</span><span class="mi">9</span><span class="err">c</span><span class="mi">107</span><span class="err">c</span><span class="mi">20</span><span class="err">-d</span><span class="mi">989-4628-83e1</span><span class="err">-e</span><span class="mi">728</span><span class="err">b</span><span class="mi">3</span><span class="err">d</span><span class="mi">4</span><span class="err">a</span><span class="mi">5e5</span><span class="err">'</span><span class="w"> </span><span class="err">\</span><span class="w">
</span><span class="err">--header</span><span class="w"> </span><span class="err">'Content-Type:</span><span class="w"> </span><span class="err">application/json'</span><span class="w"> </span><span class="err">\</span><span class="w">
</span><span class="err">--data-raw</span><span class="w"> </span><span class="err">'</span><span class="p">{</span><span class="w">
    </span><span class="nl">"fullName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Nguyen Minh Duc"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"abc5@gmail.com"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Binh Duong Province"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0123456789"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"gender"</span><span class="p">:</span><span class="w"> </span><span class="s2">"M"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"dob"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1995-10-10"</span><span class="w">
</span><span class="p">}</span><span class="err">'</span><span class="w">

</span></code></pre></div></div>

<p><a href="/assets/images/spring-boot-jpa-open-in-view-failed-test-update-customer.png"><img src="/assets/images/spring-boot-jpa-open-in-view-failed-test-update-customer.png" alt="update a customer with open in view is failed" title="with open in view is failed" /></a></p>

<ul>
  <li>Then you check the Spring Boot application log (see the log below), you will see that there are 2 JDBC connections for updating customer api. The first one is used for getting the customer, then the second one is used to update customer. Because <code class="language-plaintext highlighter-rouge">open-in-view=false</code> so everytime we interact with entity as get or update, so a transaction will be created, commited and closed immediately, In the update customer api, we do two actions: getting a customer and updating it, so JPA made 2 separated transactions and every transaction will took a JDBC connection.</li>
</ul>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Hibernate: select customeren0_.id as id1_0_0_, customeren0_.address as address2_0_0_, customeren0_.dob as dob3_0_0_, customeren0_.email as email4_0_0_, customeren0_.full_name as full_nam5_0_0_, customeren0_.gender as gender6_0_0_, customeren0_.phone as phone7_0_0_ from customers customeren0_ where customeren0_.id=?
2022-01-29 11:11:05.318  INFO 32771 --- [nio-8080-exec-2] i.StatisticalLoggingSessionEventListener : Session Metrics {
    804921 nanoseconds spent acquiring 1 JDBC connections;
    0 nanoseconds spent releasing 0 JDBC connections;
    3316634 nanoseconds spent preparing 1 JDBC statements;
    1267260 nanoseconds spent executing 1 JDBC statements;
    0 nanoseconds spent executing 0 JDBC batches;
    0 nanoseconds spent performing 0 L2C puts;
    0 nanoseconds spent performing 0 L2C hits;
    0 nanoseconds spent performing 0 L2C misses;
    0 nanoseconds spent executing 0 flushes (flushing a total of 0 entities and 0 collections);
    0 nanoseconds spent executing 0 partial-flushes (flushing a total of 0 entities and 0 collections)
}
Hibernate: select customeren0_.id as id1_0_1_, customeren0_.address as address2_0_1_, customeren0_.dob as dob3_0_1_, customeren0_.email as email4_0_1_, customeren0_.full_name as full_nam5_0_1_, customeren0_.gender as gender6_0_1_, customeren0_.phone as phone7_0_1_, orders1_.customer_id as customer6_2_3_, orders1_.id as id1_2_3_, orders1_.id as id1_2_0_, orders1_.created_date as created_2_2_0_, orders1_.customer_id as customer6_2_0_, orders1_.last_updated_date as last_upd3_2_0_, orders1_.order_name as order_na4_2_0_, orders1_.order_status as order_st5_2_0_ from customers customeren0_ left outer join orders orders1_ on customeren0_.id=orders1_.customer_id where customeren0_.id=?
Hibernate: update customers set address=?, dob=?, email=?, full_name=?, gender=?, phone=? where id=?
2022-01-29 11:11:05.402  INFO 32771 --- [nio-8080-exec-2] i.StatisticalLoggingSessionEventListener : Session Metrics {
    22940 nanoseconds spent acquiring 1 JDBC connections;
    0 nanoseconds spent releasing 0 JDBC connections;
    439798 nanoseconds spent preparing 2 JDBC statements;
    2776004 nanoseconds spent executing 2 JDBC statements;
    0 nanoseconds spent executing 0 JDBC batches;
    0 nanoseconds spent performing 0 L2C puts;
    0 nanoseconds spent performing 0 L2C hits;
    0 nanoseconds spent performing 0 L2C misses;
    28010362 nanoseconds spent executing 1 flushes (flushing a total of 2 entities and 2 collections);
    0 nanoseconds spent executing 0 partial-flushes (flushing a total of 0 entities and 0 collections)
}

</code></pre></div></div>

<ul>
  <li>Then, check your tables in database, you will there all information have been updated correctly</li>
</ul>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
mysql&gt; select * from customers;
+--------------------------------------+---------------------+---------------------+----------------+-----------------+--------+------------+
| id                                   | address             | dob                 | email          | full_name       | gender | phone      |
+--------------------------------------+---------------------+---------------------+----------------+-----------------+--------+------------+
| 9c107c20-d989-4628-83e1-e728b3d4a5e5 | Binh Duong Province | 1995-10-10 07:00:00 | abc5@gmail.com | Nguyen Minh Duc | M      | 0123456789 |
+--------------------------------------+---------------------+---------------------+----------------+-----------------+--------+------------+
1 row in set (0.01 sec)

</code></pre></div></div>

<h2 id="summary">SUMMARY</h2>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">Java Persistence API (JPA)</code> represents a simplification of the persistence programming model. <code class="language-plaintext highlighter-rouge">JPA</code> provides a mechanism for managing data persistence and object-relational mapping and functions.</li>
  <li>
    <p>By default In Spring Boot Service, JPA use OSIV (Open session in view) parttern with <code class="language-plaintext highlighter-rouge">open-in-view=true</code> configuration which allow a session will be created when the a HTTP request come in the Spring Boot service and this seesion will be closed until the HTTP request has been end.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Object-Relational Mapping (ORM)</code> is a programming technique for converting data between relational databases and object oriented programming languages such as Java, C#, etc.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Hibernate</code> is an open-source, non-invasive, light-weight java <code class="language-plaintext highlighter-rouge">ORM(Object-relational mapping)</code> framework to develop objects which are independent of the database software and make independent persistence logic in all JAVA, JEE. It simplifies the interaction of java applications with databases. <code class="language-plaintext highlighter-rouge">Hibernate</code> is an implementation of <code class="language-plaintext highlighter-rouge">JPA(Java Persistence API)</code>.</p>
  </li>
  <li>
    <p>JDBC<code class="language-plaintext highlighter-rouge"> stands for </code>Java Database Connectivity`. <strong>JDBC</strong> is a <strong>Java API</strong> to connect and execute the query with the database. It is a part of JavaSE (Java Standard Edition). <strong>JDBC API</strong> uses <strong>JDBC drivers</strong> to connect with the database.</p>
  </li>
  <li><code class="language-plaintext highlighter-rouge">HikariCP</code> is solid high-performance JDBC connection pool. A connection pool is a cache of database connections maintained so that the connections can be reused when future requests to the database are required. Connection pools may significantly reduce the overall resource usage.</li>
</ul>

<h2 id="references">REFERENCES</h2>

<ul>
  <li><a href="https://www.ibm.com/docs/en/wasdtfe?topic=applications-jpa-architecture">IBM DOCS</a></li>
  <li><a href="https://www.byteslounge.com/tutorials/container-vs-application-managed-entitymanager">BYTESLOUNGE</a></li>
  <li><a href="https://www.vincenzoracca.com/en/blog/framework/jpa/jpa-em/">VINCENZORACCA</a></li>
  <li><a href="https://stackoverflow.com/questions/30549489/what-is-this-spring-jpa-open-in-view-true-property-in-spring-boot">STACKOVERFLOW</a></li>
  <li><a href="https://www.baeldung.com/spring-open-session-in-view#choose-wisely">BEELDUNG</a></li>
  <li><a href="https://www.tutorialspoint.com/hibernate/orm_overview.htm">TUTORIALS POINT</a></li>
  <li><a href="https://dzone.com/articles/what-is-the-difference-between-hibernate-and-sprin-1">DZONE</a></li>
  <li><a href="https://www.infoworld.com/article/3388036/what-is-jdbc-introduction-to-java-database-connectivity.html">INFO WORLD</a></li>
  <li><a href="https://www.geeksforgeeks.org/difference-between-jdbc-and-hibernate-in-java/">GEEKS FOR GEEKS</a></li>
  <li><a href="https://zetcode.com/articles/hikaricp/">ZCODE</a>.</li>
  <li><a href="https://github.com/brettwooldridge/HikariCP">GITHUB HIKARICP</a>.</li>
  <li><a href="https://commons.apache.org/proper/commons-dbcp/configuration.html">COMMONS DBCP APACHE</a>.</li>
  <li><a href="https://docs.jboss.org/hibernate/orm/5.4/userguide/html_single/Hibernate_User_Guide.html#configurations-internal">JBOSS DOC</a>.</li>
</ul>

    </div><a class="u-url" href="/java/2021/09/11/java-springboot-JDBC-JPA.html" hidden></a>
  </article>
  
</div>


    </div>
  </div>
  <script src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
  <script>addBackToTop()</script>
</body>
<footer><footer class="site-footer h-card">
  <div class="container">
    <div class="row">
      <div class="col-md-4">
        <h2 class="footer-heading">KaizenThink</h2>
        <div>
          <div>
            <ul>
              <li>Duc Nguyen</li><li><a class="u-email" href="mailto:minhducnguyen189@gmail.com">minhducnguyen189@gmail.com</a></li><li>&copy; 2021 Duc Nguyen. Powered by <a href="https://jekyllrb.com/">Jekyll</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <data class="u-url" href="/%20/"></data>
        <div><ul class="social-media-list"><li><a href="https://github.com/minhducnguyen189"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">minhducnguyen189</span></a></li><li><a href="https://www.linkedin.com/in/duc-nguyen-03109b141"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">duc-nguyen-03109b141</span></a></li></ul>
</div>
      </div>
      <div class="col-md-4">
        <h3>Support me</h3>
        <!-- PayPal Logo -->
        <table id="sponsor" border='0' cellpadding='10' cellspacing='0' align='center'>
          <tr>
            <td align='center'>
              <a href='https://www.paypal.com/paypalme/minhduc189' title='Sponsor me'
                onclick="javascript:window.open('https://www.paypal.com/paypalme/minhduc189','WIPaypal','toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=yes, resizable=yes, width=1060, height=700'); return false;">
                <img src='https://www.paypalobjects.com/webstatic/en_US/i/buttons/PP_logo_h_150x38.png' alt='PayPal Acceptance | Medium v2' />
              </a>
            </td>
          </tr>
        </table>
        <!-- PayPal Logo -->
      </div>
    </div>
  </div>
</footer>
</footer>
</html>