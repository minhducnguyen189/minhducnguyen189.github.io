<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- bootstrap library and JS, Jquery -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"></script><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Exception Handler With Message Source In SpringBoot | KaizenThink</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="Exception Handler With Message Source In SpringBoot" />
<meta name="author" content="Duc Nguyen" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="In this post we will learn about exception handling with message source in Spring Boot." />
<meta property="og:description" content="In this post we will learn about exception handling with message source in Spring Boot." />
<link rel="canonical" href="/java/2021/11/28/java-springboot-exception-handler-message-source.html" />
<meta property="og:url" content="/java/2021/11/28/java-springboot-exception-handler-message-source.html" />
<meta property="og:site_name" content="KaizenThink" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-11-28T00:00:00+07:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Exception Handler With Message Source In SpringBoot" />
<script type="application/ld+json">
{"@type":"BlogPosting","url":"/java/2021/11/28/java-springboot-exception-handler-message-source.html","author":{"@type":"Person","name":"Duc Nguyen"},"headline":"Exception Handler With Message Source In SpringBoot","dateModified":"2021-11-28T00:00:00+07:00","datePublished":"2021-11-28T00:00:00+07:00","description":"In this post we will learn about exception handling with message source in Spring Boot.","mainEntityOfPage":{"@type":"WebPage","@id":"/java/2021/11/28/java-springboot-exception-handler-message-source.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="KaizenThink" /><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NZ8G5007GK"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NZ8G5007GK');
</script></head><body>
  <div class="container-flush">
    <div class="row"><!-- navigation bar -->
<div class="col-lg-12">
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark" role="banner"><a class="navbar-brand site-title" rel="author" href="/">KaizenThink</a>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="nav navbar-nav"><li class="nav-item active">
          <a class="nav-link" href="/about">About</a>
        </li><li class="nav-item active">
          <a class="nav-link" href="/">Java</a>
        </li><li class="nav-item active">
          <a class="nav-link" href="/docker">Docker</a>
        </li><li class="nav-item active">
          <a class="nav-link" href="/database">Database</a>
        </li><li class="nav-item active">
          <a class="nav-link" href="/data-science">Data-Science</a>
        </li><li class="nav-item active">
          <a class="nav-link" href="/ci-cd">CI-CD</a>
        </li><li class="nav-item active">
          <a class="nav-link" href="/python">Python</a>
        </li><li class="nav-item active">
          <a class="nav-link" href="/fe">FE</a>
        </li><li class="nav-item active">
          <a class="nav-link" href="/others">Others</a>
        </li></ul>
    </div>

    <!-- Html Elements for Search -->
    <div id="search-container" class="btn-group">
      <input type="text" id="search-input" placeholder="search...">
      <button id="clear">clear</button>
      <ul id="results-container"></ul>
    </div>

    <!-- Script pointing to search-script.js -->
    <script src="/java-scripts/search-script.js" type="text/javascript"></script>

    <!-- Configuration -->
    <script>
      SimpleJekyllSearch({
        searchInput: document.getElementById('search-input'),
        resultsContainer: document.getElementById('results-container'),
        json: '/search.json'
      })
    </script>

    <!-- search clear -->
    <script>
      window.addEventListener('load', () => {
        const button = document.querySelector('#clear');
        button.addEventListener('click', () => {
          document.querySelector('#search-input').value = "";
          document.querySelector('#results-container').innerHTML = "";
        });
      });
    </script>
    <!-- enable checkboxes-->
    <script>
      window.addEventListener('DOMContentLoaded', () => {
        const checkboxes = document.getElementsByClassName('task-list-item-checkbox');
        for(ind=0;ind<checkboxes.length;ind++) {
          checkboxes[ind].removeAttribute('disabled');
        }
      });
    </script>
  </nav>
</div></div>
  </div>

  <div class="container">
    <div class="row">
      <div class="col-lg-8 mx-auto">
  <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
      <h1 class="post-title p-name" itemprop="name headline">Exception Handler With Message Source In SpringBoot</h1>
      <p class="post-meta">
        <time class="dt-published" datetime="2021-11-28T00:00:00+07:00" itemprop="datePublished">Nov 28, 2021
        </time></p>
    </header>
  
    <div class="post-content e-content" itemprop="articleBody">
      <blockquote>
  <p>In this post we will learn about exception handling with message source in Spring Boot.</p>
</blockquote>

<ul id="markdown-toc">
  <li><a href="#why-do-we-need-exception-handling" id="markdown-toc-why-do-we-need-exception-handling">WHY DO WE NEED EXCEPTION HANDLING?</a></li>
  <li><a href="#configure-message-source" id="markdown-toc-configure-message-source">CONFIGURE MESSAGE SOURCE</a></li>
  <li><a href="#create-a-custom-exception" id="markdown-toc-create-a-custom-exception">CREATE A CUSTOM EXCEPTION</a></li>
  <li><a href="#create-an-exception-handler" id="markdown-toc-create-an-exception-handler">CREATE AN EXCEPTION HANDLER</a></li>
  <li><a href="#testing" id="markdown-toc-testing">TESTING</a></li>
  <li><a href="#summary" id="markdown-toc-summary">SUMMARY</a></li>
</ul>

<h2 id="why-do-we-need-exception-handling">WHY DO WE NEED EXCEPTION HANDLING?</h2>

<ul>
  <li>Exception handling is very important in software projects because it will decide what are next steps that software should handle when an exception happens in run time. For example, if an exception happens in loading data in database so we can notify to FE a message with is friendly and familiar with user/business so they can know what is happening to take action. For developers they will know where this exception happened and find root causes easier by reading or searching logs. Moreover, in special softwares regarding to finance and banking, developers have to handle all exceptions that can occur closely with business cases.</li>
</ul>

<h2 id="configure-message-source">CONFIGURE MESSAGE SOURCE</h2>

<ul>
  <li><code class="language-plaintext highlighter-rouge">MessageSource</code> is a powerful feature available in Spring applications. This helps application developers handle various complex scenarios with writing much extra code, such as environment-specific configuration, internationalization or configurable values. One more scenario could be modifying the default validation messages to more user-friendly/custom messages.</li>
  <li><a href="https://www.baeldung.com/spring-custom-validation-message-source">More information</a>.</li>
  <li>In spring boot <code class="language-plaintext highlighter-rouge">MessageSource</code> has been added as default, so you don’t need to add any dependency for this feature. However, you have to create a configuration for using. So, let’s create a configuration class <code class="language-plaintext highlighter-rouge">AppConfig</code> and put configuration codes as below</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">package</span> <span class="nn">com.exception.handler.demo.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.MessageSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.support.ResourceBundleMessageSource</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppConfig</span> <span class="o">{</span>

    <span class="nd">@Bean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"messageSource"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">MessageSource</span> <span class="nf">messageSourceConfig</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">ResourceBundleMessageSource</span> <span class="n">messageSource</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ResourceBundleMessageSource</span><span class="o">();</span>
        <span class="n">messageSource</span><span class="o">.</span><span class="na">setBasenames</span><span class="o">(</span><span class="s">"messages/error"</span><span class="o">);</span>
        <span class="n">messageSource</span><span class="o">.</span><span class="na">setDefaultEncoding</span><span class="o">(</span><span class="s">"UTF-8"</span><span class="o">);</span>
        <span class="n">messageSource</span><span class="o">.</span><span class="na">setUseCodeAsDefaultMessage</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">messageSource</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>Note: by default the name of the bean is the method name, so you have to add <code class="language-plaintext highlighter-rouge">@Bean(name = "messageSource")</code> if you are using a custom method name. Then you need to set <code class="language-plaintext highlighter-rouge">Basenames</code> for messageSource which include the path and the suffix of your properties files. Let’s see the image below.</li>
</ul>

<p><a href="/assets/images/spring-boot-message-source-structure-project.PNG"><img src="/assets/images/spring-boot-message-source-structure-project.PNG" alt="message source project structure" title="message source project structure" /></a></p>

<ul>
  <li>
    <p>Then you need to create <code class="language-plaintext highlighter-rouge">properties</code> files to contain messages, I will create 3 properties file with 3 different languages.</p>
  </li>
  <li>
    <p>Note: By default when you use Intellij to create <code class="language-plaintext highlighter-rouge">properties</code> files, your files will be encoded as <code class="language-plaintext highlighter-rouge">ISO-88591</code>. So when you put other languages, for example: Japanese or Vietnamese languages, the messages can not be encoded to <code class="language-plaintext highlighter-rouge">UTF-8</code> then you can not read your messages in these languages. To solve this issue you need to create <code class="language-plaintext highlighter-rouge">properties</code> files with <code class="language-plaintext highlighter-rouge">UTF-8</code> encoding.</p>
  </li>
  <li>
    <p>So you need to open <code class="language-plaintext highlighter-rouge">File</code> -&gt; <code class="language-plaintext highlighter-rouge">Settting</code> of Intellij, then you choose the path to your <code class="language-plaintext highlighter-rouge">properties</code> files with Encoding is <code class="language-plaintext highlighter-rouge">UTF-8</code> and choose default encoding for <code class="language-plaintext highlighter-rouge">properties</code> files as <code class="language-plaintext highlighter-rouge">UTF-8</code> too. let’s see the image below.</p>
  </li>
</ul>

<p><a href="/assets/images/spring-boot-message-source-intellij-encoding-config.png"><img src="/assets/images/spring-boot-message-source-intellij-encoding-config.png" alt="intellij encoding for properties files configuration" title="intellij encoding for properties files configuration" /></a></p>

<ul>
  <li>Next, create<code class="language-plaintext highlighter-rouge">error.properties</code> file as in the image, it will contain default language as English, so we will define an example message as below.</li>
</ul>

<pre><code class="language-.properties">
service.customer.email.1=can not find any customer following email {0}

</code></pre>

<ul>
  <li>In the <code class="language-plaintext highlighter-rouge">error_ja.properties</code> file we will add Japanese message as below:</li>
</ul>

<pre><code class="language-.properties">
service.customer.email.1=メールをフォローしている顧客が見つかりません {0} - JP

</code></pre>

<ul>
  <li>Finally, in the <code class="language-plaintext highlighter-rouge">error_vi.properties</code> file, we will add Vietnamese message as below:</li>
</ul>

<pre><code class="language-.properties">
service.customer.email.1=Không tìm thấy bất kỳ khác hàng nào với email {0} - VN

</code></pre>

<h2 id="create-a-custom-exception">CREATE A CUSTOM EXCEPTION</h2>

<ul>
  <li>
    <p>We will create a custom exception from <code class="language-plaintext highlighter-rouge">RuntimeException</code> class, because it is the top and represent for <code class="language-plaintext highlighter-rouge">unchecked exception</code> in Java. If you don’t know what is the <strong>checked exception</strong> or <strong>unchecked exception</strong> you can view <a href="/java/2021/02/08/java-general-part2.html#checked-and-unchecked-exception-in-java">this post</a> for more details.</p>
  </li>
  <li>
    <p>So, we will create an exception name <code class="language-plaintext highlighter-rouge">ResourceNotFoundException</code> and it is extended from <code class="language-plaintext highlighter-rouge">RuntimeException</code>. Then we will create 3 constructors and 2 attributes as below.</p>
  </li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">package</span> <span class="nn">com.exception.handler.demo.exception</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ResourceNotFoundException</span> <span class="kd">extends</span> <span class="nc">RuntimeException</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">messageKey</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span><span class="o">[]</span> <span class="n">param</span><span class="o">;</span>


    <span class="kd">public</span> <span class="nf">ResourceNotFoundException</span><span class="o">(</span><span class="nc">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">messageKey</span> <span class="o">=</span> <span class="n">message</span><span class="o">;</span>
        <span class="n">param</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">ResourceNotFoundException</span><span class="o">(</span><span class="nc">String</span> <span class="n">message</span><span class="o">,</span> <span class="nc">String</span><span class="o">...</span> <span class="n">param</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">messageKey</span> <span class="o">=</span> <span class="n">message</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">param</span> <span class="o">=</span> <span class="n">param</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">ResourceNotFoundException</span><span class="o">(</span><span class="nc">String</span> <span class="n">message</span><span class="o">,</span> <span class="nc">Throwable</span> <span class="n">cause</span><span class="o">,</span> <span class="nc">String</span><span class="o">...</span> <span class="n">param</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">message</span><span class="o">,</span> <span class="n">cause</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">messageKey</span> <span class="o">=</span> <span class="n">message</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">param</span> <span class="o">=</span> <span class="n">param</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getMessageKey</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">messageKey</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span><span class="o">[]</span> <span class="nf">getParam</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">param</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>So with these constructors, we will have 3 ways to create <code class="language-plaintext highlighter-rouge">ResourceNotFoundException</code>. For example.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nc">ResourceNotFoundException</span> <span class="n">exception1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ResourceNotFoundException</span><span class="o">(</span><span class="s">"message"</span><span class="o">)</span>

<span class="nc">ResourceNotFoundException</span> <span class="n">exception2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ResourceNotFoundException</span><span class="o">(</span><span class="s">"message"</span><span class="o">,</span> <span class="s">"sample param"</span><span class="o">)</span>

<span class="nc">ResourceNotFoundException</span> <span class="n">exception3</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ResourceNotFoundException</span><span class="o">(</span><span class="s">"message"</span><span class="o">,</span> <span class="n">cause</span><span class="o">,</span> <span class="s">"sample param"</span><span class="o">)</span>

</code></pre></div></div>

<h2 id="create-an-exception-handler">CREATE AN EXCEPTION HANDLER</h2>

<ul>
  <li>To create an exception handler, the first thing we need to do is creating a response model (response body). Create a model <code class="language-plaintext highlighter-rouge">ErrorDetail</code> as below</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">package</span> <span class="nn">com.exception.handler.demo.model.exception</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.time.LocalDateTime</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ErrorResponse</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">timestamp</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">message</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">errorCode</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">status</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">api</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">key</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">ErrorDetail</span> <span class="n">detail</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">LocalDateTime</span> <span class="nf">getTimestamp</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">timestamp</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTimestamp</span><span class="o">(</span><span class="nc">LocalDateTime</span> <span class="n">timestamp</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">timestamp</span> <span class="o">=</span> <span class="n">timestamp</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getMessage</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">message</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMessage</span><span class="o">(</span><span class="nc">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getErrorCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">errorCode</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setErrorCode</span><span class="o">(</span><span class="kt">int</span> <span class="n">errorCode</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">errorCode</span> <span class="o">=</span> <span class="n">errorCode</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getStatus</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">status</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setStatus</span><span class="o">(</span><span class="nc">String</span> <span class="n">status</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">status</span> <span class="o">=</span> <span class="n">status</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getApi</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">api</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setApi</span><span class="o">(</span><span class="nc">String</span> <span class="n">api</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">api</span> <span class="o">=</span> <span class="n">api</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getKey</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">key</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setKey</span><span class="o">(</span><span class="nc">String</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">ErrorDetail</span> <span class="nf">getDetail</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">detail</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDetail</span><span class="o">(</span><span class="nc">ErrorDetail</span> <span class="n">detail</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">detail</span> <span class="o">=</span> <span class="n">detail</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">ErrorResponse</code> contains <code class="language-plaintext highlighter-rouge">ErrorDetail</code> so we will create <code class="language-plaintext highlighter-rouge">ErrorDetail</code> as below.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">package</span> <span class="nn">com.exception.handler.demo.model.exception</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ErrorDetail</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">stacktrace</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getStacktrace</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">stacktrace</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setStacktrace</span><span class="o">(</span><span class="nc">String</span> <span class="n">stacktrace</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">stacktrace</span> <span class="o">=</span> <span class="n">stacktrace</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>Next, We will create an exception handler class named <code class="language-plaintext highlighter-rouge">GlobalExceptionHandler</code> which will extends from <code class="language-plaintext highlighter-rouge">ResponseEntityExceptionHandler</code> class, by default the <code class="language-plaintext highlighter-rouge">ResponseEntityExceptionHandler</code> will provide an <code class="language-plaintext highlighter-rouge">@ExceptionHandler</code> method for handling internal Spring MVC exceptions which include exceptions below.</li>
</ul>

<hr />

<ul>
  <li>HttpRequestMethodNotSupportedException.class</li>
  <li>HttpMediaTypeNotSupportedException.class</li>
  <li>HttpMediaTypeNotAcceptableException.class</li>
  <li>MissingPathVariableException.class</li>
  <li>MissingServletRequestParameterException.class</li>
  <li>ServletRequestBindingException.class</li>
  <li>ConversionNotSupportedException.class</li>
  <li>TypeMismatchException.class</li>
  <li>HttpMessageNotReadableException.class</li>
  <li>HttpMessageNotWritableException.class</li>
  <li>MethodArgumentNotValidException.class</li>
  <li>MissingServletRequestPartException.class</li>
  <li>BindException.class</li>
  <li>NoHandlerFoundException.class</li>
  <li>AsyncRequestTimeoutException.class</li>
</ul>

<hr />

<ul>
  <li>In our case, we want to handle our custom exception and return custom response body so that is the reason why we extends from <code class="language-plaintext highlighter-rouge">ResponseEntityExceptionHandler</code>.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">package</span> <span class="nn">com.exception.handler.demo.handler</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.exception.handler.demo.exception.ResourceNotFoundException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.exception.handler.demo.model.exception.ErrorDetail</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.exception.handler.demo.model.exception.ErrorResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.MessageSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.HttpStatus</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.context.request.WebRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.mvc.method.annotation.ResponseEntityExceptionHandler</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.time.LocalDateTime</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Locale</span><span class="o">;</span>

<span class="nd">@ControllerAdvice</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GlobalExceptionHandler</span> <span class="kd">extends</span> <span class="nc">ResponseEntityExceptionHandler</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">MessageSource</span> <span class="n">messageSource</span><span class="o">;</span>

    <span class="nd">@ResponseStatus</span><span class="o">(</span><span class="nc">HttpStatus</span><span class="o">.</span><span class="na">NOT_FOUND</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="o">{</span><span class="nc">ResourceNotFoundException</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>
    <span class="kd">public</span> <span class="nc">ErrorResponse</span> <span class="nf">handleResourceNotFoundException</span><span class="o">(</span><span class="nc">ResourceNotFoundException</span> <span class="n">ex</span><span class="o">,</span> <span class="nc">WebRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">Locale</span> <span class="n">locale</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">errorMessage</span> <span class="o">=</span> <span class="n">messageSource</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(</span><span class="n">ex</span><span class="o">.</span><span class="na">getMessageKey</span><span class="o">(),</span> <span class="n">ex</span><span class="o">.</span><span class="na">getParam</span><span class="o">(),</span> <span class="n">locale</span><span class="o">);</span>
        <span class="nc">ErrorResponse</span> <span class="n">errorResponse</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ErrorResponse</span><span class="o">();</span>
        <span class="n">errorResponse</span><span class="o">.</span><span class="na">setErrorCode</span><span class="o">(</span><span class="nc">HttpStatus</span><span class="o">.</span><span class="na">NOT_FOUND</span><span class="o">.</span><span class="na">value</span><span class="o">());</span>
        <span class="n">errorResponse</span><span class="o">.</span><span class="na">setMessage</span><span class="o">(</span><span class="n">errorMessage</span><span class="o">);</span>
        <span class="n">errorResponse</span><span class="o">.</span><span class="na">setTimestamp</span><span class="o">(</span><span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">());</span>
        <span class="n">errorResponse</span><span class="o">.</span><span class="na">setApi</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getDescription</span><span class="o">(</span><span class="kc">false</span><span class="o">));</span>
        <span class="n">errorResponse</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="nc">HttpStatus</span><span class="o">.</span><span class="na">NOT_FOUND</span><span class="o">.</span><span class="na">getReasonPhrase</span><span class="o">());</span>
        <span class="n">errorResponse</span><span class="o">.</span><span class="na">setKey</span><span class="o">(</span><span class="n">ex</span><span class="o">.</span><span class="na">getMessageKey</span><span class="o">());</span>
        <span class="nc">ErrorDetail</span> <span class="n">errorDetail</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ErrorDetail</span><span class="o">();</span>
        <span class="n">errorDetail</span><span class="o">.</span><span class="na">setStacktrace</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">ex</span><span class="o">.</span><span class="na">getStackTrace</span><span class="o">()));</span>
        <span class="n">errorResponse</span><span class="o">.</span><span class="na">setDetail</span><span class="o">(</span><span class="n">errorDetail</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">errorResponse</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>We will define the exception that we want to resolve in <code class="language-plaintext highlighter-rouge">@ExceptionHandler(value = {&lt;your custome exception class&gt;})</code>. Then We also use the <code class="language-plaintext highlighter-rouge">MessageSource</code> to get the message that we defined in <code class="language-plaintext highlighter-rouge">properties</code> file following the default <code class="language-plaintext highlighter-rouge">Locale</code>. Form the custom exception <code class="language-plaintext highlighter-rouge">ResourceNotFoundException</code> we can get some information and put it into the reponse body <code class="language-plaintext highlighter-rouge">ErrorResponse</code>.</li>
</ul>

<h2 id="testing">TESTING</h2>

<ul>
  <li>Now, we will create a sample service and controller to test our custom exception. A sample service will look like below</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomerService</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">CustomerRepository</span> <span class="n">customerRepository</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">CustomerResponse</span> <span class="nf">getCustomerByEmail</span><span class="o">(</span><span class="nc">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">CustomerEntity</span> <span class="n">customerEntity</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">customerRepository</span><span class="o">.</span><span class="na">findCustomerByEmail</span><span class="o">(</span><span class="n">email</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="nc">Objects</span><span class="o">.</span><span class="na">isNull</span><span class="o">(</span><span class="n">customerEntity</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ResourceNotFoundException</span><span class="o">(</span><span class="s">"service.customer.email.1"</span><span class="o">,</span> <span class="n">email</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">toCustomerResponse</span><span class="o">(</span><span class="n">customerEntity</span><span class="o">);</span>
    <span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>We create <code class="language-plaintext highlighter-rouge">ResourceNotFoundException</code> with message <code class="language-plaintext highlighter-rouge">service.customer.email.1</code> which is the key of message that we defined in <code class="language-plaintext highlighter-rouge">properties</code> files.</li>
  <li>Then we create a controller as below</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">package</span> <span class="nn">com.exception.handler.demo.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.exception.handler.demo.model.CustomerRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.exception.handler.demo.model.CustomerResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.exception.handler.demo.service.CustomerService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.HttpStatus</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.MediaType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.ResponseEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.UUID</span><span class="o">;</span>

<span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Controller</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">CustomerService</span> <span class="n">customerService</span><span class="o">;</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">method</span> <span class="o">=</span> <span class="nc">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span> <span class="n">path</span> <span class="o">=</span> <span class="s">"/v1/customers"</span><span class="o">,</span> <span class="n">produces</span> <span class="o">=</span> <span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON_VALUE</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">CustomerResponse</span><span class="o">&gt;</span> <span class="nf">getCustomerByEmail</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"email"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">email</span> <span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nc">ResponseEntity</span><span class="o">&lt;&gt;(</span><span class="n">customerService</span><span class="o">.</span><span class="na">getCustomerByEmail</span><span class="o">(</span><span class="n">email</span><span class="o">),</span> <span class="nc">HttpStatus</span><span class="o">.</span><span class="na">OK</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>For the Entity and Repository, please view full source code in <code class="language-plaintext highlighter-rouge">SUMMARY</code> path of this post or you can create them by yourself.</li>
  <li>Finally, we will add some configuration in to <code class="language-plaintext highlighter-rouge">application.yml</code>, I would like to set the default <code class="language-plaintext highlighter-rouge">Locale</code> as <strong>Japan</strong>. So I should got the error message with Japanese languages.</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="na">spring</span><span class="pi">:</span>
  <span class="na">datasource</span><span class="pi">:</span>
<span class="c1">#    url: jdbc:h2:mem:testdb</span>
    <span class="na">url</span><span class="pi">:</span> <span class="s">jdbc:h2:file:./testdb</span>
    <span class="na">username</span><span class="pi">:</span> <span class="s">sa</span>
    <span class="na">password</span><span class="pi">:</span> <span class="s">password</span>
    <span class="na">driver-class-name</span><span class="pi">:</span> <span class="s">org.h2.Driver</span>
    <span class="na">platform</span><span class="pi">:</span> <span class="s">h2</span>
  <span class="na">jpa</span><span class="pi">:</span>
    <span class="na">database-platform</span><span class="pi">:</span> <span class="s">org.hibernate.dialect.H2Dialect</span>
    <span class="na">hibernate.ddl-auto</span><span class="pi">:</span> <span class="s">update</span>
    <span class="na">generate-ddl</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">show-sql</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">h2</span><span class="pi">:</span>
    <span class="na">console</span><span class="pi">:</span>
      <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">path</span><span class="pi">:</span> <span class="s">/h2-console</span>
      <span class="na">settings</span><span class="pi">:</span>
        <span class="na">trace</span><span class="pi">:</span> <span class="no">false</span>
        <span class="na">web-allow-others</span><span class="pi">:</span> <span class="no">false</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">locale</span><span class="pi">:</span> <span class="s">ja_JP</span>
    <span class="na">locale-resolver</span><span class="pi">:</span> <span class="s">fixed</span>

</code></pre></div></div>

<ul>
  <li>Now, start the service and use postman to call api, then you will see the result as below.</li>
</ul>

<p><a href="/assets/images/spring-boot-message-source-test-result-1.png"><img src="/assets/images/spring-boot-message-source-test-result-1.png" alt="test result with Japan locale" title="test result with Japan locale" /></a></p>

<ul>
  <li>Then when we configure locale as <strong>VietNam</strong> so, we will received a Vietnamese message.</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="na">spring</span><span class="pi">:</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">locale</span><span class="pi">:</span> <span class="s">vi_VN</span>
    <span class="na">locale-resolver</span><span class="pi">:</span> <span class="s">fixed</span>

</code></pre></div></div>

<p><a href="/assets/images/spring-boot-message-source-test-result-2.png"><img src="/assets/images/spring-boot-message-source-test-result-2.png" alt="test result with Vietnam locale" title="test result with Vietnam locale" /></a></p>

<ul>
  <li>If we do not configure default Locale or we configure a locale that does not existed in our messages resource, so the service will automatically return the default message in <code class="language-plaintext highlighter-rouge">error.properties</code> file.</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="na">spring</span><span class="pi">:</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">locale</span><span class="pi">:</span> <span class="s">it_IT</span>
    <span class="na">locale-resolver</span><span class="pi">:</span> <span class="s">fixed</span>

<span class="c1"># or comment out as below.</span>

<span class="c1"># spring:</span>
<span class="c1">#   web:</span>
<span class="c1">#     locale: it_IT</span>
<span class="c1">#     locale-resolver: fixed    </span>

</code></pre></div></div>

<p><a href="/assets/images/spring-boot-message-source-test-result-3.png"><img src="/assets/images/spring-boot-message-source-test-result-3.png" alt="test result with default locale" title="test result with default locale" /></a></p>

<h2 id="summary">SUMMARY</h2>

<ul>
  <li>
    <p>In conclusion, Exception handling is very important in software development, it is not only help users know what happened in system but also help developer can determine quickly and exactly the root causes.</p>
  </li>
  <li>
    <p>We create a custom exception by extend <code class="language-plaintext highlighter-rouge">RuntimeException</code> class because it is the top of unchecked exceptions. It means every exception happened at runtime will be navigated to <code class="language-plaintext highlighter-rouge">RuntimeException</code>.</p>
  </li>
  <li>
    <p>We can create an exception handler with a class using <code class="language-plaintext highlighter-rouge">@ControllerAdvice</code> and extended from <code class="language-plaintext highlighter-rouge">ResponseEntityExceptionHandler</code>. In this class methods can handle one or more Exceptions with support of <code class="language-plaintext highlighter-rouge">@ExceptionHandler</code>. From information of custom exceptions we can build the response body following what we want.</p>
  </li>
  <li>
    <p>With the supports from Spring Framework, <code class="language-plaintext highlighter-rouge">MessageSource</code> is very helpful when we want to change error message language or simply use it as a place to contain all error messages which will help us maintain error messages and use them easier.</p>
  </li>
  <li>
    <p>To view full source code you can go to this <a href="https://github.com/minhducnguyen189/com.springboot.project/tree/master/exception-handler-app">github link</a></p>
  </li>
</ul>

    </div><a class="u-url" href="/java/2021/11/28/java-springboot-exception-handler-message-source.html" hidden></a>
  </article>
  
</div>


    </div>
  </div>
  <script src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
  <script>addBackToTop()</script>
</body>
<footer><footer class="site-footer h-card">
  <div class="container">
    <div class="row">
      <div class="col-md-4">
        <h2 class="footer-heading">KaizenThink</h2>
        <div>
          <div>
            <ul>
              <li>Duc Nguyen</li><li><a class="u-email" href="mailto:minhducnguyen189@gmail.com">minhducnguyen189@gmail.com</a></li><li>&copy; 2021 Duc Nguyen. Powered by <a href="https://jekyllrb.com/">Jekyll</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <data class="u-url" href="/%20/"></data>
        <div><ul class="social-media-list"><li><a href="https://github.com/minhducnguyen189"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">minhducnguyen189</span></a></li><li><a href="https://www.linkedin.com/in/duc-nguyen-03109b141"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">duc-nguyen-03109b141</span></a></li></ul>
</div>
      </div>
      <div class="col-md-4">
        <h3>Support me</h3>
        <!-- PayPal Logo -->
        <table id="sponsor" border='0' cellpadding='10' cellspacing='0' align='center'>
          <tr>
            <td align='center'>
              <a href='https://www.paypal.com/paypalme/minhduc189' title='Sponsor me'
                onclick="javascript:window.open('https://www.paypal.com/paypalme/minhduc189','WIPaypal','toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=yes, resizable=yes, width=1060, height=700'); return false;">
                <img src='https://www.paypalobjects.com/webstatic/en_US/i/buttons/PP_logo_h_150x38.png' alt='PayPal Acceptance | Medium v2' />
              </a>
            </td>
          </tr>
        </table>
        <!-- PayPal Logo -->
      </div>
    </div>
  </div>
</footer>
</footer>
</html>